# 第五章 FIR数字滤波器的设计

你好！在上一章，我们一同探索了IIR数字滤波器的设计世界，学习了如何借助成熟的模拟滤波器理论来构建它们。现在，我们将开启新的篇章，聚焦于另一类非常重要的数字滤波器——**FIR (Finite Impulse Response) 数字滤波器**。

你可能会问，既然已经有了IIR滤波器，为什么还需要FIR滤波器呢？它们各自又有什么独特的魅力和适用场景呢？FIR滤波器以其**总是稳定**和能够**轻易实现严格线性相位**这两大核心优势，在许多信号处理应用中占据了不可或缺的地位，尤其是在对相位失真非常敏感的场合，如数据传输、图像处理、高保真音频等。

在本章中，我们将一起：
*   理解FIR滤波器的基本定义和核心特性。
*   深入探讨线性相位FIR滤波器的奥秘，了解其不同类型及其对频率响应的影响。
*   学习两种主流的FIR滤波器设计方法：**标准窗函数法**和**频率取样法**。
*   对比FIR与IIR滤波器，帮助你根据应用需求做出明智选择。
*   最后，我们还会简单了解FIR滤波器的常见实现结构。

让我们开始这段精彩的FIR滤波器设计之旅吧！🚀

---

## 引言

FIR（Finite Impulse Response，有限冲激响应）滤波器是数字滤波器两大基本类型之一。顾名思义，它的核心特征在于其单位冲激响应$h(n)$是有限长度的。

---

## FIR数字滤波器：基本概念 🧱

#### FIR 系统定义

一个数字滤波器DF的输出$y(n)$，如果**仅仅取决于有限个过去的和现在的输入**$x(n), x(n-1), \dots, x(n-N+1)$，则称之为FIR DF。
这意味着它是一个**非递归 (non-recursive)** 系统，其输出不依赖于过去的输出值。

#### FIR滤波器的I/O关系：卷积和
FIR滤波器的输入$x(n)$和输出$y(n)$之间的关系可以通过卷积和来表示：
$\boxed{ y(n) = \sum_{r=0}^{N-1} h(r)x(n-r) }$
这里：
*  $h(r)$是滤波器的单位冲激响应。
*  $N$是滤波器的长度（或阶数，有时也用$N-1$表示阶数，即滤波器的最高延迟项）。

#### FIR滤波器的单位冲激响应$h(n)$
其单位冲激响应$h(n)$是**有限时宽**的：
$\boxed{ h(n), \quad n = 0, 1, 2, \dots, N-1 }$
在其他时刻，$h(n)=0$。这正是“有限冲激响应”名称的由来。

#### FIR滤波器的系统函数$H(z)$
对单位冲激响应$h(n)$进行Z变换，我们得到FIR滤波器的系统函数$H(z)$：
$\boxed{ H(z) = \sum_{r=0}^{N-1} h(r)z^{-r} }$
这个式子可以写成一个关于$z^{-1}$的多项式：
$H(z) = h(0) + h(1)z^{-1} + h(2)z^{-2} + \dots + h(N-1)z^{-(N-1)}$
如果将其表示为$z$的有理分式，分子是$z$的多项式，分母是$z^{N-1}$：
$H(z) = \frac{h(0)z^{N-1} + h(1)z^{N-2} + \dots + h(N-1)}{z^{N-1}}$

*   **零极点特性** 💡：
    *   从上式可以看出，$H(z)$在$z$平面上有$N-1$个零点（由分子多项式的根决定）。
    *  $H(z)$在原点$z=0$处有一个$(N-1)$阶的极点。

---

## FIR数字滤波器的特点 ✨

FIR滤波器因其独特的性质而备受青睐：

1.  **(1) 稳定 (Stability)** 👍
    *   ① **单位冲激响应有限长，非递归**：这是最根本的原因。由于冲激响应是有限的，它总是绝对可和的 ($\sum_{n=-\infty}^{\infty} |h(n)| < \infty$)。
    *   ② **绝对可和**: 这是BIBO（Bounded-Input Bounded-Output）稳定的充分必要条件。
    *   ③ **极点在单位圆内部**: FIR滤波器的所有极点都在$z=0$处，这远在单位圆内部，因此FIR滤波器**总是稳定的**。这是相对于IIR滤波器的一个巨大优势，IIR滤波器需要仔细设计以确保极点在单位圆内。

2.  **(2) 具有线性相位特性 (Linear Phase Capability)** 📐
    *   通过适当地设计$h(n)$的系数（使其具有对称性），FIR滤波器可以很容易地实现**严格的线性相位**。这意味着信号通过滤波器时，所有频率分量的延迟时间都相同，从而避免了相位失真。这对于图像处理、数据传输等对波形保真度要求高的应用至关重要。
    *   *我们将稍后详细讨论线性相位FIR滤波器。*

3.  **(3) 易于硬件实现 (Easy Hardware Implementation)** ⚙️
    *   由于FIR滤波器是非递归结构（只依赖输入），它通常可以用直接的抽头延迟线结构实现，没有反馈环路。这使得硬件实现相对简单，并且不容易出现由反馈引起的数值不稳定问题。

---

## 线性相位FIR DF (Linear Phase FIR DF) 📏

在许多应用中，我们不仅关心滤波器的幅度响应，也非常关心其相位响应。理想情况下，我们希望滤波器不要引入相位失真。

#### FIR数字滤波器的频率响应
滤波器的频率响应$H(e^{j\omega})$通常表示为：
$H(e^{j\omega}) = H_r(\omega)e^{j\theta(\omega)}$
其中：
*  $H_r(\omega)$是**幅度函数 (Amplitude Function)**，注意它与**幅频特性$|H(e^{j\omega})|$不同**。$H_r(\omega)$是一个实函数，其值可正可负。当$H_r(\omega) < 0$时，表示该频率分量除了有$\theta(\omega)$的相移外，还有一个额外的$\pi$相移。
*  $\theta(\omega) = \arg[H(e^{j\omega})]$是相频特性。

#### 线性相位的定义
线性相位FIR DF是指其相频特性$\theta(\omega)$是频率$\omega$的线性函数。具体分为两种：

1.  **严格线性相位 (Strictly Linear Phase)**
    如果$\theta(\omega)$满足：
   $\boxed{ \theta(\omega) = -\tau\omega \quad (1) }$
    其中$\tau$是一个常数，代表群延迟。满足式(1)的FIR滤波器称为严格线性相位滤波器。

2.  **广义线性相位 (Generalized Linear Phase)**
    如果$\theta(\omega)$满足：
   $\boxed{ \theta(\omega) = \phi_0 - \tau\omega \quad (2) }$
    其中$\phi_0$是初始相位 (通常是$0$或$\pm \pi/2$的整数倍)，$\tau$是常数群延迟。满足式(2)的FIR滤波器称为广义线性相位滤波器。

#### 相位失真 (Phase Distortion) 💔
*   当信号通过一个（幅度）线性滤波器时，其幅度和相位都可能发生改变。滤波器的幅频特性$|H(\omega)|$和相频特性$\theta(\omega)$都会随频率变化。
*   输入正弦信号$A\cos(n\omega_0)$，输出为$|H(\omega_0)|A\cos(n\omega_0 + \theta(\omega_0))$。
*   **延迟与位移**：输出信号比输入信号滞后的样点数$n_d$(位移) 可以通过令输出信号的相位$n\omega_0 + \theta(\omega_0)$等于输入信号的某个参考相位（例如0）来近似。如果我们考虑群延迟，即信号包络的延迟，它由$\tau_g = -d\theta(\omega)/d\omega$给出。如果$\theta(\omega)$不是线性的，那么不同频率分量的延迟$n_d(\omega_0) = -\theta(\omega_0)/\omega_0$(相位延迟) 或群延迟$\tau_g(\omega_0)$就会不同。
*   **后果**：如果一个包含多种频率成分的信号（如方波）通过一个非线性相位的滤波器，各个频率成分会经历不同的时间延迟，导致输出信号的波形发生畸变，这就是**相位失真**。
    *   **一个直观的例子**：一个方波可以由基波和多次谐波的正弦波叠加而成。如果每个正弦波都经历一个恒定的相移（例如$\pi/2$），但由于它们各自的频率不同，导致它们的时间延迟$n = -\theta/\omega$不同，那么叠加后的波形就不再是原来的方波（或其移位版本）了，波形会严重失真。
    * ![](Pic/Pasted%20image%2020250528101851.png)
*   **如何避免相位失真？**
    确保不产生相位失真的办法是：**使不同频率的信号通过滤波器时有相同的延迟$n_d$。** 这就要求滤波器的相频特性$\theta(\omega)$必须是$\omega$的线性函数，即$\theta(\omega) = C - n_d\omega$(这里$n_d$对应$\tau$)。

#### 线性相位 vs. 非线性相位：直观对比

*   **线性相位系统**:
    *   输入信号$x_1(t) = \sin(t)$和$x_2(t) = \sin(2t)$。它们的和为$y(t) = x_1(t)+x_2(t)$。
    *   经过一个具有线性相位的系统 A (例如，该系统使所有频率分量都延迟$t_d = \pi$秒)，输出$y_1(t)$的波形与$y(t)$相同，只是整体向右平移了$\pi$秒。各个频率分量$x_1(t-\pi)$和$x_2(t-\pi)$都经历了相同的时延。
    * ![](Pic/Pasted%20image%2020250528101952.png)

#### 恒延时特性与线性相位

滤波器的延时分为两种：
1.  **相延时 (Phase Delay)**:$\boxed{ \tau_p(\omega) = -\frac{\theta(\omega)}{\omega} }$
    它表示单个频率分量正弦波的稳态延迟。
2.  **群延时 (Group Delay)**:$\boxed{ \tau_g(\omega) = -\frac{d\theta(\omega)}{d\omega} }$
    它表示窄带信号包络的延迟，或者说是一组频率相近的正弦波的平均延迟。对于波形保持非常重要。

**恒延时滤波器**：是指$\tau_p(\omega)$或$\tau_g(\omega)$(或两者都) 是不随$\omega$变化的常数。

*   **严格线性相位**$\theta(\omega) = -\tau\omega$:
    *  $\tau_p(\omega) = -(-\tau\omega)/\omega = \tau$(常数)
    *  $\tau_g(\omega) = -d(-\tau\omega)/d\omega = \tau$(常数)
    *   结论：严格线性相位意味着**恒定的相延时和恒定的群延时**，且两者相等。

*   **广义线性相位**$\theta(\omega) = \phi_0 - \tau\omega$:
    *  $\tau_p(\omega) = -(\phi_0 - \tau\omega)/\omega = \tau - \phi_0/\omega$(不是常数，除非$\phi_0=0$)
    *  $\tau_g(\omega) = -d(\phi_0 - \tau\omega)/d\omega = \tau$(常数)
    *   结论：广义线性相位（当$\phi_0 \ne 0$时）只保证**恒定的群延时**。

**因此，具有线性相位的FIR DF具有恒延时的特点，这是避免相位失真的关键。**

---

## 线性相位FIR DF的约束条件 🧐

要使FIR滤波器具有线性相位，其单位冲激响应$h(n)$必须满足特定的对称性条件。

#### 1. 严格线性相位 ($\theta(\omega) = -\tau\omega$) 的约束条件

*   **回顾**: 频率响应$H(e^{j\omega}) = \sum_{n=0}^{N-1} h(n)e^{-jn\omega} = \sum_{n=0}^{N-1} h(n)[\cos(n\omega) - j\sin(n\omega)]$。
*   相位函数$\theta(\omega) = \arg[H(e^{j\omega})] = \arctan \left( \frac{-\sum_{n=0}^{N-1} h(n)\sin(n\omega)}{\sum_{n=0}^{N-1} h(n)\cos(n\omega)} \right)$。
*   令$\theta(\omega) = -\tau\omega$，则$\tan(\theta(\omega)) = \tan(-\tau\omega) = -\tan(\tau\omega)$。
*   所以，$\frac{-\sum h(n)\sin(n\omega)}{\sum h(n)\cos(n\omega)} = -\frac{\sin(\tau\omega)}{\cos(\tau\omega)}$。
*   化简得到：$\sum_{n=0}^{N-1} h(n)[\sin(n\omega)\cos(\tau\omega) - \cos(n\omega)\sin(\tau\omega)] = 0$。
*   即：$\boxed{ \sum_{n=0}^{N-1} h(n)\sin((n-\tau)\omega) = 0 }$
*   **如何满足这个条件？**
    一个充分条件是，让求和式中的项成对抵消或自身为零。这可以通过设置合适的$\tau$值和$h(n)$的对称性来实现。
    如果令延迟$\boxed{\tau = \frac{N-1}{2}}$(即延迟是序列长度中心的一半)，
    并且单位冲激响应$h(n)$关于这个中心点**偶对称 (even symmetry)**:
   $$\boxed{ h(n) = h(N-1-n) \quad \text{for } 0 \le n \le N-1 }$$
    那么上述求和条件就能满足。
    *   **此时，相延时和群延时均为**$\tau_p(\omega) = \tau_g(\omega) = \tau = \frac{N-1}{2}$。

*   **严格线性相位滤波器的必要条件是：**
    不管$N$为偶数，还是$N$为奇数，系统冲激响应$h(n)$都必须关于中心点$(N-1)/2$**偶对称**。
    *   当$N$为奇数时，对称中心$(N-1)/2$是一个整数样点。
    *   当$N$为偶数时，对称中心$(N-1)/2$位于两个样点之间 (非整数样点)。
    *   ![](Pic/Pasted%20image%2020250528103127.png)

    这类具有偶对称$h(n)$的滤波器被称为**第一类线性相位** (如果$N$为奇数) 或**第二类线性相位** (如果$N$为偶数)。

#### 2. 广义线性相位 ($\theta(\omega) = \phi_0 - \tau\omega$) 的约束条件

*   我们只要求恒群延时$\tau_g(\omega) = \tau$(常数)。这意味着相移特性$\theta(\omega) = \phi_0 - \tau\omega$(不过原点的直线)。
*   类似的推导，最终条件变为：
   $$\sum_{n=0}^{N-1} h(n)\sin((n-\tau)\omega - \phi_0) = 0$$
*   **如何满足这个条件？**
    令延迟$\boxed{\tau = \frac{N-1}{2}}$(与严格线性相位相同)，
    并且单位冲激响应$h(n)$关于这个中心点**奇对称 (odd symmetry)**:
   $$\boxed{ h(n) = -h(N-1-n) \quad \text{for } 0 \le n \le N-1 }$$
    同时，初始相位$\phi_0$必须是$\pm \pi/2$的奇数倍，即$\phi_0 = (2k+1)\pi/2$。
    在实际中，我们通常只考虑$\boxed{ \phi_0 = \pi/2 }$(当$k=0$) 或$\phi_0 = -\pi/2$。
    *   **此时，群延时为**$\tau_g(\omega) = \tau = \frac{N-1}{2}$。
    *   相频特性为$\theta(\omega) = \frac{\pi}{2} - \frac{N-1}{2}\omega$。

*   **满足广义线性相位FIR滤波器的必要条件为：**
    冲激响应$h(n)$对中心点$(N-1)/2$成**奇对称**。此时，无论$N$为奇数或偶数，滤波器的相频特性均为线性，并包含有$\pi/2$的固定相移。
    *   **重要特性**：如果$N$为奇数，由于奇对称性$h(n) = -h(N-1-n)$，在对称中心点$n_0 = (N-1)/2$处，我们有$h(n_0) = -h(N-1-n_0) = -h(n_0)$，这意味着$\boxed{h\left(\frac{N-1}{2}\right) = 0}$。
    *   信号通过此类滤波器时不仅产生$(N-1)/2$个取样点的延迟，还将产生$90^\circ$的相移，通常这类滤波器又被称为 **$90^\circ$移相器 (Hilbert Transformers 的离散近似)**，并具有很好的应用价值。
    *   ![](Pic/Pasted%20image%2020250528103508.png)

    这类具有奇对称$h(n)$的滤波器被称为**第三类线性相位** (如果$N$为奇数) 或**第四类线性相位** (如果$N$为偶数)。

#### 3. 线性相位约束条件的物理意义
*   **核心结论**：对于任意给定的长度$N$，当 FIR 滤波器的$h(n)$相对其中心点$(N-1)/2$是**偶对称或者奇对称时**，此时滤波器的相移特性是线性的，且群延时都是$\tau = (N-1)/2$。
*   **频域表现**：
    *   对于偶对称 $h(n)$ (Type I, II): $H(e^{j\omega}) = A(\omega) e^{-j\tau\omega}$, 其中 $A(\omega)$ 是实值幅度函数。
    *   对于奇对称 $h(n)$ (Type III, IV): $H(e^{j\omega}) = A(\omega) e^{j(\pi/2 - \tau\omega)}$, 其中 $A(\omega)$ 是实值幅度函数。
    *   更一般地可以写成 $H(e^{j\omega}) = A(\omega) e^{j(\phi_0 - \tau\omega)}$, 其中 $A(\omega)$ 是实值幅度函数，$\phi_0$ 对于偶对称是 $0$，对于奇对称是 $\pm \pi/2$。
*   **时域表现**：对于一个理想的线性相位系统，输出信号$y(n)$仅仅是输入信号$x(n)$的一个**幅度缩放$k$倍并延迟$\tau$个样本**的结果，即$y(n) \approx kx(n-\tau)$（这里的$k$可能随频率变化，即$A(\omega)$）。最重要的是，**波形不失真**。
*   对一个滤波器来说，也就保证了在通带内，对各种频率的信号都作线性延迟，这样滤波后的信号就不会发生相位失真。

---

## 线性相移 FIR DF 的4种类型及其频率响应 📊

根据$h(n)$的对称性（偶对称或奇对称）和序列长度$N$（奇数或偶数），线性相位FIR滤波器可以分为四种类型。每种类型都有其独特的频率响应特性。

![](Pic/Pasted%20image%2020250528111548.png)
#### 频率响应的具体形式$H(e^{j\omega}) = H_r(\omega)e^{j\theta(\omega)}$

对于这四种类型，我们可以推导出其实际幅度函数$H_r(\omega)$(注意，这不同于$|H(e^{j\omega})|$，因为$H_r(\omega)$可以为负)。

![](Pic/Pasted%20image%2020250528111609.png)

**示例**
$H(z) = \frac{1}{10}(1+0.9z^{-1}+2.1z^{-2}+0.9z^{-3}+z^{-4})$
$h(n) = \frac{1}{10}\{1, 0.9, 2.1, 0.9, 1\}$,$N=5$.
由于$h(0)=h(4)$,$h(1)=h(3)$,$h(2)=2.1$, 这是偶对称，$N$为奇数。所以是 **Type I**。
$\tau = (5-1)/2 = 2$.
$H_r(\omega) = h(2) + 2h(1)\cos(\omega) + 2h(0)\cos(2\omega)$
$H_r(\omega) = \frac{1}{10} [2.1 + 2(0.9)\cos(\omega) + 2(1)\cos(2\omega)] = \frac{1}{10} [2.1 + 1.8\cos\omega + 2\cos2\omega]$
相位函数$\theta(\omega) = -\tau\omega = -2\omega$.

---

## 5.2.3 线性相移FIR-DF零极点分布 📍 

#### 一般FIR DF的零、极点
*  $H(z) = \frac{h(0)z^{N-1} + \dots + h(N-1)}{z^{N-1}} = \frac{f(z)}{z^{N-1}}$
*   **极点**: 在$z=0$处，有一个$(N-1)$阶的极点。由于极点在原点，FIR滤波器总是稳定的。
*   **零点**: 由分子多项式$f(z)=0$决定。有$N-1$个零点。
*   如果$h(n)$为实数值，则$f(z)$的根（即$H(z)$的零点）是**共轭对称**的。即如果$z_0$是一个零点，则其共轭$z_0^*$也是一个零点。

#### 线性相移FIR DF的零极点特性
对于线性相位FIR滤波器，其冲激响应满足$h(n) = \pm h(N-1-n)$。
可以证明，其系统函数满足一个重要的性质：
$$\boxed{ H(z) = \pm z^{-(N-1)}H(z^{-1}) }$$
从这个关系式我们可以推断出零点的分布规律：
如果$z_i$是$H(z)$的一个零点 (即$H(z_i)=0$)，那么$H(z_i^{-1})$也必须为0 (除非$z_i=0$, 但FIR的零点不为0)。
因此，**如果$z_i$是一个零点，则$1/z_i$也是一个零点。**

#### 零点分布总结
结合$h(n)$实系数（零点共轭对称）和线性相位（零点互为倒数），我们可以总结零点的分布：
如果$z_i = r_i e^{j\omega_i}$是一个零点，那么：
1. $z_i^* = r_i e^{-j\omega_i}$也是零点 (共轭)。
2. $1/z_i = (1/r_i)e^{-j\omega_i}$也是零点 (倒数)。
3. $(1/z_i)^* = (1/r_i)e^{j\omega_i}$也是零点 (倒数的共轭)。

这组成了所谓的“**四元组 (quad)**”零点，除非零点位于特殊位置：
*   **单位圆上的零点**: 如果$r_i=1$, 则$z_i = e^{j\omega_i}$。此时$1/z_i = e^{-j\omega_i} = z_i^*$。所以这类零点成共轭对出现$e^{\pm j\omega_i}$(除非$\omega_i=0$或$\pi$)。
*   **实轴上的零点**: 如果$\omega_i=0$或$\pi$, 则$z_i$是实的。此时$z_i^*=z_i$。零点成倒数对出现$b, 1/b$(除非$b=\pm 1$)。
*   **$z=\pm 1$处的零点**: 这些是自共轭且自倒数的，可以是单个零点（如果它们是多项式的根）。
*   **$z=0$处的零点**: FIR滤波器没有零点在$z=0$(除非所有$h(N-1)=0$导致阶数降低)，它有极点在$z=0$。

**图示**：
清晰地展示了非单位圆、非实轴零点（①, ②, ③, ④形成四元组），单位圆零点 ($z_{a1}, z_{a2}$形成共轭对)，实轴零点 ($b, 1/b$形成倒数对)。
![](Pic/Pasted%20image%2020250528214218.png)

**示例**
1.  已知线性相位FIR系统有零点：$4e^{-j\pi/3}$,$3$,$e^{-j\pi/5}$。
    *   对于$z_1 = 4e^{-j\pi/3}$:
        *  $z_1^* = 4e^{j\pi/3}$
        *  $1/z_1 = (1/4)e^{j\pi/3}$
        *  $(1/z_1)^* = (1/4)e^{-j\pi/3}$
    *   对于$z_2 = 3$:
        *  $1/z_2 = 1/3$
    *   对于$z_3 = e^{-j\pi/5}$(在单位圆上):
        *  $z_3^* = e^{j\pi/5}$(也是$1/z_3$)
    集合所有唯一的零点：$\{4e^{-j\pi/3}, 4e^{j\pi/3}, (1/4)e^{j\pi/3}, (1/4)e^{-j\pi/3}, 3, 1/3, e^{-j\pi/5}, e^{j\pi/5}\}$。
    共有8个零点。滤波器长度$N = (\text{非原点零点数}) + 1 = 8+1 = 9$。

2.  已知$z_0 = 0.25e^{j\pi/2}$是 **Type II** 线性相位FIR滤波器 ($h(n)$为实数) 的零点。
    *   Type II 特点:$h(n)$偶对称，$N$为偶数。频率响应$H_r(\pi)=0$，所以$z=-1$必为一个零点。
    *   由$z_0 = 0.25e^{j\pi/2}$，我们得到四元组（实际上是二元组因为在虚轴上，倒数也是共轭的某种形式）：
        *  $z_0^* = 0.25e^{-j\pi/2}$
        *  $1/z_0 = 4e^{-j\pi/2}$
        *  $(1/z_0)^* = 4e^{j\pi/2}$
    *   所以，其他零点一定还有：$0.25e^{-j\pi/2}$,$4e^{j\pi/2}$,$4e^{-j\pi/2}$, 以及$z=-1$。  
    *   (幻灯片答案：$0.25e^{-j\pi/2}, 4e^{j\pi/2}, 4e^{-j\pi/2}, -1$)

---
*现在我们已经对FIR滤波器的基本特性，特别是线性相位的重要性及其实现条件有了深入的了解。接下来，我们将学习如何实际设计出满足特定性能指标的FIR滤波器。最常用的方法之一就是窗函数法。*

## 5.3 窗函数法设计线性相位FIR滤波器 🖼️

窗函数法是一种经典且直观的FIR滤波器设计技术。其核心思想是：
1.  从理想的频率响应$H_d(e^{j\omega})$出发，求出其对应的理想单位冲激响应$h_d(n)$。
2.  由于$h_d(n)$通常是无限长的且非因果的，无法直接实现。
3.  我们通过一个“窗函数”$w(n)$来截取$h_d(n)$的一部分，得到一个有限长的$h(n)$。
4.  然后对$h(n)$进行适当的移位，使其成为因果的线性相位FIR滤波器。

#### 窗函数法的逼近原理

*   **思路**:
    *   **理想数字滤波器**:$H_d(e^{j\omega}) = \sum_{n=-\infty}^{\infty} h_d(n)e^{-jn\omega}$
        *  $h_d(n)$通常无限长，且非因果 (例如，理想低通的$h_d(n)$是sinc函数，双边无限)，不可实现。
    *   **设计的FIR数字滤波器**:$H(e^{j\omega}) = \sum_{n=0}^{N-1} h(n)e^{-jn\omega}$
        *  $h(n)$有限长，且因果，物理可实现。

*   **如何从$h_d(n)$得到$h(n)$？**
	**答：截短 (Truncation) / 加窗 (Windowing)**:
       $h(n) = h_d'(n) \cdot w(n)$
        其中$h_d'(n)$是$h_d(n)$经过某种处理（例如移位以使其对称中心在原点附近）后的版本，而$w(n)$是一个有限长度的窗函数。
        这个过程相当于在时域对理想冲激响应进行“截断”。

*   **频域的对应关系**:
    时域相乘等价于频域周期卷积：
   $\boxed{ H(e^{j\omega}) = \frac{1}{2\pi} [H_d(e^{j\omega}) * W(e^{j\omega})] }$
    其中$W(e^{j\omega})$是窗函数$w(n)$的傅里叶变换。
    设计的目标就是选择合适的窗函数$w(n)$，使得卷积后的$H(e^{j\omega})$尽可能逼近$H_d(e^{j\omega})$，同时满足线性相位等要求。

*   **要求**:
    *   **线性相位**：通过对称的$h_d(n)$和对称的窗函数（或通过后续构造）来实现。
    *   **尽可能降低逼近误差**：选择合适的窗函数是关键。

#### 窗函数法：基本原理步骤

1.  **理想频率响应$H_d(e^{j\omega})$**:
    这是我们期望的滤波器特性，例如理想低通、高通等。它是频域中的周期函数（周期$2\pi$），可以展开为傅里叶级数：
   $H_d(e^{j\omega}) = \sum_{n=-\infty}^{\infty} h_d(n)e^{-jn\omega}$
    其傅里叶系数$h_d(n)$就是理想的单位冲激响应：
   $\boxed{ h_d(n) = \frac{1}{2\pi} \int_{-\pi}^{\pi} H_d(e^{j\omega})e^{jn\omega} d\omega }$
    这个$h_d(n)$通常是双边无限长且非因果的 (例如，对于关于原点偶对称的$H_d(e^{j\omega})$，$h_d(n)$是关于$n=0$偶对称的)。

2.  **系统函数$H_d(z)$**:
   $H_d(z) = \sum_{n=-\infty}^{\infty} h_d(n)z^{-n}$
    显然，$H_d(z)$是非因果的，且$h_d(n)$持续时间为$-\infty \sim +\infty$，物理上不可实现。

3.  **采用逼近$H_d(e^{j\omega})$的方法**:
    *   **① 首先把$h_d(n)$先截短为有限项**:
        假设我们希望设计的FIR滤波器长度为$N$。
        如果$N$为奇数，令$N=2M+1$。我们截取$h_d(n)$中以$n=0$为中心的$N$项，即从$n=-M$到$n=M$。
       $H_1(z) = \sum_{n=-M}^{M} h_d(n)z^{-n}$
        这个$H_1(z)$对应的冲激响应$h_1(n)$是有限长的，但仍然是非因果的。
        (如果$N$为偶数，$N=2M$，则对称中心不在整数点，截取方式稍有不同，但原理一致，通常截取$M$个负半轴点和$M$个正半轴点，或通过设计使得对称中心为$(N-1)/2$)。

    *   **② 然后把截短后的$h_1(n)$右移，使之变成因果序列**:
        为了得到一个因果的滤波器$H(z)$，我们将$H_1(z)$乘以$z^{-M}$(即时域右移$M$个单位)。
       $H(z) = z^{-M} H_1(z) = z^{-M} \sum_{n=-M}^{M} h_d(n)z^{-n} = \sum_{n=-M}^{M} h_d(n)z^{-(n+M)}$
        令$k = n+M$，则当$n=-M, k=0$; 当$n=M, k=2M=N-1$。
       $H(z) = \sum_{k=0}^{N-1} h_d(k-M)z^{-k}$

    *   **③ 得到因果的FIR滤波器冲激响应$h(n)$**:
       $\boxed{ h(n) = h_d(n-M), \quad n=0, 1, \dots, N-1 \quad (M=\frac{N-1}{2}) }$
        这个$h(n)$就是我们设计的FIR滤波器的系数。
        *   **物理可实现**:$H(z)$是$z^{-1}$的$N-1$阶多项式，是物理可实现的。
        *   **线性相位**: 如果原始的$H_d(e^{j\omega})$是实函数（即零相位）或具有线性相位且关于原点对称，那么$h_d(n)$将会是偶对称的 ($h_d(n)=h_d(-n)$)。此时，$h(n) = h_d(n-M)$将会关于其中心$M=(N-1)/2$偶对称，即$h(n)=h(N-1-n)$，从而保证了线性相位。
        *   **逼近性**:$H(e^{j\omega})$是对$H_d(e^{j\omega})$的逼近。

#### 性能分析：矩形窗的影响
将$h_d(n)$截短，相当于将理想的（可能是关于原点对称的）$h_d(n)$乘以一个**矩形窗函数$w_R(n)$**：
$w_R(n) = \begin{cases} 1, & |n| \le \frac{N-1}{2} \\ 0, & \text{else} \end{cases}$
(这里假设$N$是奇数,$M=(N-1)/2$。窗函数中心在$n=0$)
那么，截短后的非因果冲激响应$h_{trunc}(n) = h_d(n)w_R(n)$。
其傅里叶变换 (频率响应) 为：
$H_{trunc}(e^{j\omega}) = \frac{1}{2\pi} [H_d(e^{j\omega}) * W_R(e^{j\omega})]$
其中$W_R(e^{j\omega})$是矩形窗$w_R(n)$(中心在0，长度N) 的频谱：
$\boxed{ W_R(e^{j\omega}) = \sum_{n=-(N-1)/2}^{(N-1)/2} e^{-jn\omega} = \frac{\sin(N\omega/2)}{\sin(\omega/2)} }$
这是一个实函数（Dirichlet核或周期sinc函数），具有一个主瓣和无穷多个旁瓣。
*   **主瓣宽度**: 从左第一个零点到右第一个零点大约是$4\pi/N$(以$N\omega/2 = \pm \pi$为界)。
*   **旁瓣**: 当n趋近于无穷时，最高的旁瓣峰值约为主瓣峰值的$2/\pi \approx 0.217$(即$-13.2$dB)。

(最终的因果$h(n)$是$h_{trunc}(n-M)$，其频谱$H(e^{j\omega}) = H_{trunc}(e^{j\omega})e^{-jM\omega}$，幅度不变，仅增加线性相位。)

#### 吉布斯效应 (Gibbs Phenomenon) 🌊
当理想频率响应$H_d(e^{j\omega})$存在不连续点（例如理想低通滤波器的截止频率处）时，用矩形窗截断其冲激响应$h_d(n)$会导致在频域产生**吉布斯效应**。
*   **表现**:
    *   在不连续点附近，实际滤波器的频率响应$H(e^{j\omega})$会出现**上冲 (overshoot) 和下冲 (undershoot)**，形成肩峰和波动。
    *   即使增加窗的长度$N$(即增加FIR滤波器的阶数)，这些波动的峰值（相对于不连续处的跳变幅度）**不会减小**，大约保持在跳变幅度的 **9%** 左右。
    *   增加$N$只会使波动更加密集地集中在不连续点附近，即过渡带会变窄，但峰值振荡幅度不变。
*   **原因**: 这是因为矩形窗的频谱$W_R(e^{j\omega})$具有较高的旁瓣。这些旁瓣在与$H_d(e^{j\omega})$进行卷积时，会在不连续点附近产生振荡。
*   **结论**:
    1.  **过渡带**: 正负肩峰之间的频带，其宽度约等于矩形窗频谱的主瓣宽度$4\pi/N$。增加$N$可使过渡带变陡。
    2.  **肩峰及波动**: 由窗函数的旁瓣引起。旁瓣越多、相对值越大，波动越厉害，肩峰越强。改善阻带衰减特性（即减小旁瓣影响）**只能通过改变窗函数的形状，而与$N$无关** (指相对波动幅度)。
![](Pic/Pasted%20image%2020250528222304.png)
#### 窗函数的选取原则与性能评价
为了减小吉布斯效应，改善滤波器的性能，我们需要选择比矩形窗更好的窗函数。

*   **回顾加窗的影响**:
    1.  理想滤波器的不连续点演化为过渡带。
    2.  通带与阻带内出现起伏——波动。
    3.  Gibbs现象。

*   **窗函数的选取原则**:
    1.  **尽可能减少主瓣宽度**：以使过渡带尽量陡峭。
    2.  **旁瓣相对于主瓣越小越好**：这样可使肩峰和波动减小，即能量尽可能集中于主瓣内。
    *   这两个要求通常是**相互制约**的。主瓣窄的窗（如矩形窗）旁瓣通常较高；旁瓣低的窗（如汉宁窗、布莱克曼窗）主瓣通常较宽。

*   **窗函数性能的评价指标 (频域)**:
    1.  **过渡带宽$\Delta\omega = \omega_s - \omega_p$**: 对于窗函数本身，是指其主瓣宽度。
    2.  **第一旁瓣峰值$A$(dB)**: (相对于主瓣峰值)$A$越小（绝对值越大，即衰减越大），由旁瓣引起的谱失真越小。
    3.  **最小阻带衰减$A_s$(dB)**: 指窗谱中所有旁瓣的最大值所对应的衰减。
    4.  **旁瓣谱峰衰减速度$D$(dB/oct)**: 指旁瓣幅度随频率远离主瓣而下降的速度。

    一个好的窗函数，应该有**尽量小**的$\Delta\omega$(主瓣宽度)、**尽量小**的$A$和$A_s$(旁瓣低)、以及**尽量大**的$D$(旁瓣衰减快)。

#### 常用窗函数及其性能

1.  **矩形窗 (Rectangular Window)**
    *  $w(n) = 1, \quad 0 \le n \le N-1$(因果形式)
    *  $W_r(\omega) = \left| \frac{\sin(N\omega/2)}{\sin(\omega/2)} \right|$(幅度响应)
    *   **性能指标**:
        *   主瓣宽度 (到第一零点):$2\pi/N$(单边)，总宽度$4\pi/N$。
        *   最大旁瓣峰值 (第一旁瓣):$\approx -13 \text{ dB}$。
        *   最小阻带衰减 (渐近):$\approx -21 \text{ dB}$(对于远端旁瓣)。
        *   精确过渡带宽 (基于累积谱定义):$\Delta\omega \approx 1.8\pi/N$。但通常用主瓣宽度$4\pi/N$或$6\pi/N$(等效矩形带宽) 来估计滤波器过渡带。
    *   **评价**: 主瓣最窄，但旁瓣最高，性能最差（从阻带衰减角度看）。

2.  **升余弦窗族 (Raised Cosine Windows)**
    一般形式 (因果，长度N，对称中心$(N-1)/2$):
   $w(n) = A - B\cos\left(\frac{2\pi n}{N-1}\right) + C\cos\left(\frac{4\pi n}{N-1}\right), \quad 0 \le n \le N-1$

    *   **汉宁窗 (Hanning Window)**:$A=0.5, B=0.5, C=0$.
        *  $w(n) = 0.5 - 0.5\cos\left(\frac{2\pi n}{N-1}\right)$
        *   主瓣宽度 (近似):$8\pi/N$。
        *   最大旁瓣峰值:$\approx -32 \text{ dB}$。
        *   最小阻带衰减:$\approx -44 \text{ dB}$。
        *   过渡带宽 (滤波器):$\approx 6.2\pi/N$。
        *   评价: 旁瓣比矩形窗低很多，但主瓣宽了一倍。
		![](Pic/Pasted%20image%2020250528224500.png)
		![](Pic/Pasted%20image%2020250528224511.png)
    *   **汉明窗 (Hamming Window)**:$A=0.54, B=0.46, C=0$.
        *  $w(n) = 0.54 - 0.46\cos\left(\frac{2\pi n}{N-1}\right)$
        *   主瓣宽度:$\approx 8\pi/N$。
        *   最大旁瓣峰值:$\approx -43 \text{ dB}$。 (比汉宁窗的第一旁瓣更低)
        *   最小阻带衰减:$\approx -53 \text{ dB}$。
        *   过渡带宽 (滤波器):$\approx 6.6\pi/N$。
        *   评价: 进一步降低了旁瓣，代价是远端旁瓣衰减速度不如汉宁窗。

    *   **布莱克曼窗 (Blackman Window)**:$A=0.42, B=0.5, C=0.08$.
        *  $w(n) = 0.42 - 0.5\cos\left(\frac{2\pi n}{N-1}\right) + 0.08\cos\left(\frac{4\pi n}{N-1}\right)$
        *   主瓣宽度:$\approx 12\pi/N$。
        *   最大旁瓣峰值:$\approx -58 \text{ dB}$。
        *   最小阻带衰减:$\approx -74 \text{ dB}$。
        *   过渡带宽 (滤波器):$\approx 11\pi/N$。
        *   评价: 旁瓣非常低，但主瓣更宽。

    **常用窗性能比较**:
    ![](Pic/Pasted%20image%2020250528224912.png)

3.  **凯泽窗 (Kaiser Window)（不考）**
    *  $w(n) = \frac{I_0\left(\beta \sqrt{1 - \left(\frac{n - (N-1)/2}{(N-1)/2}\right)^2}\right)}{I_0(\beta)}, \quad 0 \le n \le N-1$
        其中$I_0(\cdot)$是零阶第一类修正贝塞尔函数。
    *   **特点**: 凯泽窗有一个可调参数$\beta$(beta)。
        *   通过调整$\beta$，可以在主瓣宽度和旁瓣衰减之间进行灵活的折中。
        *   当$\beta=0$时，凯泽窗退化为矩形窗。
        *  $\beta$越大，主瓣越宽，旁瓣衰减越大。
    *   **设计**: Kaiser 提出了经验公式，可以根据期望的阻带衰减$A_s$(dB) 和过渡带宽$\Delta\omega$来估算所需的参数$N$和$\beta$。
        *   若$A_s > 50 \text{ dB}$:$\beta = 0.1102(A_s - 8.7)$
        *   若$21 \le A_s \le 50 \text{ dB}$:$\beta = 0.5842(A_s - 21)^{0.4} + 0.07886(A_s - 21)$
        *   若$A_s < 21 \text{ dB}$:$\beta = 0$
        *   滤波器长度$N \approx \frac{A_s - 7.95}{2.285 \Delta\omega} + 1$(其中$\Delta\omega = \omega_s - \omega_p$是数字角频率之差)
    *   Matlab: `w = kaiser(N, beta)`。
    *   （考试会给）![](Pic/Pasted%20image%2020250528225203.png)

#### 利用“标准窗函数法”设计FIR滤波器步骤

1.  **Step1: 选择窗函数类型和计算窗长度$N$**
	    *   根据要设计的滤波器的性能指标（主要是**最小阻带衰减$A_s$**），从常用窗函数中选择一个合适的窗函数类型。
    *   根据所选窗函数的**精确过渡带宽因子$D_w$** (例如，汉明窗的$D_w \approx 6.6\pi$) 和要求的滤波器**过渡带宽$\Delta\omega = \omega_s - \omega_p$**，计算窗的长度$N$:
       $\boxed{ N = \left\lceil \frac{D_w}{\Delta\omega} \right\rceil }$(向上取整)
    *   再根据线性相位的类型来决定$N$取奇数还是偶数（通常取奇数，使得对称中心$\tau=(N-1)/2$是整数，方便设计Type I或Type III）。

2.  **Step2: 构造期望逼近的理想FIR滤波器的频率响应$H_d(e^{j\omega})$**
    *   标准窗函数法就是选择$H_d(e^{j\omega})$为具有线性相位的理想滤波器（低通、高通、带通、带阻）。
    *  $H_d(e^{j\omega}) = H_{da}(\omega) e^{-j\tau\omega}$，其中$\tau=(N-1)/2$。
    *  $H_{da}(\omega)$是理想幅频特性，例如理想低通：
       $H_{da}(\omega) = \begin{cases} 1, & |\omega| \le \omega_c \\ 0, & \text{其他} \end{cases}$
    *   因此，对于理想低通：
       $H_d(e^{j\omega}) = \begin{cases} e^{-j\tau\omega}, & |\omega| \le \omega_c \\ 0, & \text{其他} \end{cases}$

3.  **Step3: 利用IDTFT计算理想冲激响应$h_d(n)$**
    *  $h_d(n) = \frac{1}{2\pi} \int_{-\pi}^{\pi} H_d(e^{j\omega}) e^{jn\omega} d\omega$
    *   对于理想低通，积分结果为：+   
       $\boxed{ h_d(n) = \frac{\sin((n-\tau)\omega_c)}{(n-\tau)\pi} }$
        (注意: 这个$h_d(n)$是以$\tau$为对称中心的，长度仍是无限的。我们接下来要用窗函数截取它。)
    *   **截止频率$\omega_c$的选择**: 如果期望的频率响应并非理想（即存在过渡带），那么截止频率$\omega_c$通常使用过渡带的**中点频率**来计算，即$\omega_c = (\omega_p + \omega_s)/2$。

4.  **Step4: 加窗获得设计结果$h(n)$**
    *   将上一步得到的理想冲激响应$h_d(n)$与选定的窗函数$w(n)$(长度为$N$，因果，从$n=0$到$N-1$) 相乘：
       $\boxed{ h(n) = h_d(n) \cdot w(n), \quad n=0, 1, \dots, N-1 }$
        这里的$h_d(n)$使用上一步带$\tau$的公式，窗函数$w(n)$也应是针对$n=0, \dots, N-1$定义的。
        例如，Hanning窗:$w(n) = 0.5 - 0.5\cos(2\pi n/(N-1))$for$n=0, \dots, N-1$.

#### 设计示例

![](Pic/Pasted%20image%2020250528232014.png)
![](Pic/Pasted%20image%2020250528232020.png)
#### 其他滤波器类型的设计 (利用理想低通$h_{LP}(n)$)
*   **数字高通 FIR (HPF)**:
    $h_{HP}(n) = \delta(n-\tau) - h_{LP}(n)$
    其中$h_{LP}(n)$是以$\tau=(N-1)/2$为对称中心，截止频率为$\omega_c$的理想低通响应。高通的截止频率与低通的$\omega_c$相关（例如，如果LPF截止$\omega_c$，则对应HPF截止$\pi-\omega_c$，或者直接用HPF的$\omega_c$）。
    更准确地，理想HPF的$H_d(e^{j\omega})$在$|\omega| > \omega_c$时为$e^{-j\tau\omega}$。
    其冲激响应$h_d(n) = \frac{\sin((n-\tau)\pi)}{(n-\tau)\pi} - \frac{\sin((n-\tau)\omega_c)}{(n-\tau)\pi} = \text{sinc}((n-\tau)) - h_{LP}(n; \omega_c)$
    (这里的$\text{sinc}((n-\tau))$是全通的冲激响应$\delta(n-\tau)$的一种表示，当$\omega_c=\pi$时)。

*   **数字带通 FIR (BPF)**:
   $h_{BP}(n) = h_{LP2}(n) - h_{LP1}(n)$
    其中$h_{LP2}$是截止频率为$\omega_{ch}$(上截止) 的理想低通，$h_{LP1}$是截止频率为$\omega_{cl}$(下截止) 的理想低通。
   $h_d(n) = \frac{\sin((n-\tau)\omega_{ch})}{(n-\tau)\pi} - \frac{\sin((n-\tau)\omega_{cl})}{(n-\tau)\pi}$

*   **数字带阻 FIR (BSF)**:
   $h_{BS}(n) = \delta(n-\tau) - h_{BP}(n)$
    或者$h_{BS}(n) = h_{LP1}(n) + h_{HP2}(n)$
   $h_d(n) = \frac{\sin((n-\tau)\omega_{cl})}{(n-\tau)\pi} + \left[ \frac{\sin((n-\tau)\pi)}{(n-\tau)\pi} - \frac{\sin((n-\tau)\omega_{ch})}{(n-\tau)\pi} \right]$


**设计示例**
![](Pic/Pasted%20image%2020250604101922.png)
![](Pic/Pasted%20image%2020250604101928.png)

![](Pic/Pasted%20image%2020250604102025.png)
![](Pic/Pasted%20image%2020250604102136.png)
特别注意：
*   **过渡带选择**: 如果一个滤波器有多个过渡带（如带阻），选择**最窄**的那个来计算$N$，以保证所有过渡带都满足要求。

---
*窗函数法通过在时域截断理想冲激响应来实现FIR滤波器，简单直观，但性能受限于窗函数的特性。另一种方法是在频域进行操作，即频率取样法。*

## 频率取样法设计FIR数字滤波器 🎯

频率取样法是另一种设计FIR滤波器的重要方法。与窗函数法在时域进行逼近不同，频率取样法直接在**频域**，通过对理想频率响应$H_d(e^{j\omega})$进行**等间隔取样**，然后用这些取样点来重构（内插）出实际的滤波器频率响应$H(e^{j\omega})$。

*   **对比**:
    *   **窗函数法**: 时域设计。$H_d(e^{j\omega}) \xrightarrow{IDTFT} h_d(n) \xrightarrow{\times w(n)} h(n) \xrightarrow{DTFT} H(e^{j\omega})$。
        *   (1) 时域设计方法。
        *   (2) 过渡带宽度及阻带衰减受制于窗函数的形状及长度，达到所要求的性能指标不一定方便。
    *   **频率取样法**: 频域设计。$H_d(e^{j\omega}) \xrightarrow{\text{sampling}} H(k) \xrightarrow{\text{interpolation}} H(z) \rightarrow H(e^{j\omega})$。
        *   (1) 频域设计方法。
        *   (2) 更直接和方便（尤其是在优化设计时）。

#### 频域取样和内插：基本原理

*   **回顾DFT/IDFT**:
    设FIR滤波器$h(n)$长度为$N$($n=0, \dots, N-1$)。其系统函数为$H(z) = \sum_{n=0}^{N-1} h(n)z^{-n}$。
    如果在单位圆上对$H(z)$进行$N$点等间隔频率取样，即令$z_k = e^{j2\pi k/N}$for$k=0, \dots, N-1$，我们就得到$h(n)$的$N$点DFT：
   $\boxed{ H(k) = H(z)|_{z=e^{j2\pi k/N}} = \sum_{n=0}^{N-1} h(n)e^{-j2\pi nk/N} }$
    反之，可以通过IDFT从$H(k)$恢复$h(n)$：
   $\boxed{ h(n) = \frac{1}{N} \sum_{k=0}^{N-1} H(k)e^{j2\pi nk/N} }$

*   **用$H(k)$内插表示$H(z)$**:
    将$h(n)$的IDFT表达式代入$H(z)$的定义：
   $H(z) = \sum_{n=0}^{N-1} \left( \frac{1}{N} \sum_{k=0}^{N-1} H(k)e^{j2\pi nk/N} \right) z^{-n}$
    交换求和次序：
   $H(z) = \frac{1}{N} \sum_{k=0}^{N-1} H(k) \left( \sum_{n=0}^{N-1} (e^{j2\pi k/N}z^{-1})^n \right)$
    利用等比数列求和公式$\sum_{n=0}^{N-1} a^n = (1-a^N)/(1-a)$(当$a \ne 1$):
   $\sum_{n=0}^{N-1} (W_N^{-k}z^{-1})^n = \frac{1-(W_N^{-k}z^{-1})^N}{1-W_N^{-k}z^{-1}} = \frac{1-W_N^{-Nk}z^{-N}}{1-W_N^{-k}z^{-1}}$
    由于$W_N^{-Nk} = 1$。
    所以得到著名的**频率取样内插公式**:
   $\boxed{ H(z) = \frac{1-z^{-N}}{N} \sum_{k=0}^{N-1} \frac{H(k)}{1-W_N^{-k}z^{-1}} }$
    这个公式表明，$H(z)$(即整个频率响应) 可以由其在$N$个频率点的取样值$H(k)$完全确定。
    *   结构上，它包含一个**梳状滤波器**$(1-z^{-N})/N$和一个并联的**谐振器组**$\sum \frac{H(k)}{1-W_N^{-k}z^{-1}}$。

*   **频率响应$H(e^{j\omega})$的内插**:
    将$z = e^{j\omega}$代入上式，经过一些三角变换，可以得到$H(e^{j\omega})$的另一种内插形式：
   $H(e^{j\omega}) = e^{-j\frac{N-1}{2}\omega} \sum_{k=0}^{N-1} H(k) \frac{\sin[N(\omega - 2\pi k/N)/2]}{N\sin[(\omega - 2\pi k/N)/2]} e^{j\frac{N-1}{N}\pi k}$
    ![](Pic/Pasted%20image%2020250605001352.png)
    这个表达式表明，在两个取样点之间的频率响应，是由所有$N$个取样点$H(k)$加权一个形状类似于sinc的内插函数（或其移位版本）叠加而成的。

	特别的，对于I型线性相位滤波器，
	滤波器的频率响应可以表示为 $H(e^{j\omega}) = A_e(\omega) e^{-j\omega\alpha}$
    $A_e(\omega) = \frac{\sin(N\omega/2)}{N} \left[ \frac{H_s(0)}{\sin(\omega/2)} + \sum_{k=1}^{(N-1)/2} H_s(k)(-1)^k \left( \frac{1}{\sin((\omega - \omega_k)/2)} + \frac{1}{\sin((\omega + \omega_k)/2)} \right) \right]$
	这里的$H_s(k)$是幅度响应，无需带相位。

*   **设计过程**:
    1.  **取样**: 对期望的理想频率响应$H_d(e^{j\omega})$在$N$个等间隔频率点$\omega_k = 2\pi k/N$($k=0, \dots, N-1$) 上进行取样，得到取样值$H(k) = H_d(e^{j2\pi k/N})$。
    2.  **内插**: 利用这些$H(k)$值，通过上述内插公式得到实际的$H(z)$或$H(e^{j\omega})$。

#### 逼近效果与约束

*   **逼近性**:
    *  $H(z)$是对$H_d(z)$的近似。
    *   在**取样频率点**$\omega_k = 2\pi k/N$上，$H(e^{j\omega_k}) = H(k) = H_d(e^{j\omega_k})$，即**精确匹配**。
    *   在**两个取样点之间**，则是近似的，由内插函数决定。逼近误差的大小取决于$H_d(e^{j\omega})$的曲线形状和取样点数$N$。
    *   在$H_d(e^{j\omega})$的不连续点附近，仍然会产生肩峰和波动（类似于吉布斯现象）。

*   **对$H(k)$的约束条件 (为了线性相位)** 
    为了保证设计出的FIR滤波器$h(n)$具有实系数和线性相位，频率取样值$H(k)$不能任意选取，必须满足一定的对称性条件。这些条件源于$h(n)$的对称性和实值性。
    回顾：$H(k) = H_k e^{j\theta_k}$, 其中$H_k$是幅度，$\theta_k$是相位。

    1.  **Type I ($h(n)$偶对称，$N$奇数)**:
        *   要求$H_r(\omega)$为偶函数，$\theta(\omega) = -\frac{N-1}{2}\omega$。
        *   对$H(k)$的约束:
           $\boxed{ H_k = H_{N-k} \quad (\text{幅度对称}) }$
           $\boxed{ \theta_k = -\frac{N-1}{2} \frac{2\pi k}{N} = -k\pi \frac{N-1}{N} \quad (\text{相位线性}) }$
           
    2.  **Type II ($h(n)$偶对称，$N$偶数)**:
        *   要求$H_r(\omega)$关于$\omega=\pi$奇对称，$\theta(\omega) = -\frac{N-1}{2}\omega$。
        *   对$H(k)$的约束:
           $\boxed{ H_k = -H_{N-k} \quad (\text{幅度关于 } k=N/2 \text{ 点奇对称}) }$
           $\boxed{ \theta_k = -k\pi \frac{N-1}{N} }$

    3.  **Type III ($h(n)$奇对称，$N$奇数)**:
        *   要求$H_r(\omega)$为奇函数，$\theta(\omega) = \frac{\pi}{2} - \frac{N-1}{2}\omega$。
        *   对$H(k)$的约束:
           $\boxed{ H_k = -H_{N-k} }$
           $\boxed{ \theta_k = \frac{\pi}{2} - k\pi \frac{N-1}{N} }$
            且$H(0)=0$。如果$N$是奇数，$(N-1)/2$是中心点，通常$H((N-1)/2)=0$。

    4.  **Type IV ($h(n)$奇对称，$N$偶数)**:
        *   要求$H_r(\omega)$关于$\omega=\pi$偶对称，$\theta(\omega) = \frac{\pi}{2} - \frac{N-1}{2}\omega$。
        *   对$H(k)$的约束:
           $\boxed{ H_k = H_{N-k} }$
           $\boxed{ \theta_k = \frac{\pi}{2} - k\pi \frac{N-1}{N} }$
            且$H(0)=0$。

#### 频率取样法设计步骤

1.  **确定理想频率响应$H_d(e^{j\omega})$**:
    通常设为$H_d(e^{j\omega}) = H_{da}(\omega)e^{-j\tau\omega}$(对于偶对称$h(n)$) 或$H_d(e^{j\omega}) = j H_{da}(\omega)e^{-j\tau\omega}$(对于奇对称$h(n)$)，其中$H_{da}(\omega)$是理想的实幅度函数，$\tau=(N-1)/2$。
2.  **对$H_d(e^{j\omega})$进行$N$点等间隔取样得到$H(k)$**:
   $H(k) = H_d(e^{j2\pi k/N})$。要确保这些$H(k)$值满足所选线性相位类型的对称性约束。
3.  **计算滤波器系数$h(n)$或系统函数$H(z)$**:
    *   可以通过对$H(k)$进行$N$点IDFT得到$h(n)$，然后$H(z) = \sum h(n)z^{-n}$。
    *   或者直接使用频率取样内插公式$H(z) = \frac{1-z^{-N}}{N} \sum_{k=0}^{N-1} \frac{H(k)}{1-W_N^{-k}z^{-1}}$。
![](Pic/Pasted%20image%2020250605141015.png)
![](Pic/Pasted%20image%2020250605141021.png)
![](Pic/Pasted%20image%2020250605141029.png)
#### 频率取样法总结

*   **优点**:
    *   在频域直接设计，适合最优化设计。
    *   原理和计算相对简单 (尤其当N是2的幂次时可用FFT/IFFT)。
    *   通过改变阶数$N$和设置过渡点，通常能取得满意结果。
*   **缺点**:
    *   不能精确地确定通带和阻带的边缘频率，因为取样频率只能是$2\pi/N$的整数倍。要实现自由选择截止频率，必须增加$N$，增加计算量。
    *   直接实现的频率取样结构（见后文）可能存在稳定性问题。

---

## FIR与IIR数字滤波器的比较 🆚

| 特性          | IIR 数字滤波器                 | FIR 数字滤波器                   |
| ----------- | ------------------------- | --------------------------- |
| **实现手段**    | 基于经典模拟滤波器设计方法 (冲激不变、双线性等) | 标准窗函数法、频率取样法                |
| **相同指标下阶数** | 低                         | 高                           |
| **稳定性**     | 可能存在稳定性问题 (需保证极点在单位圆内)    | 总是稳定 (极点在原点)                |
| **相位失真**    | 通常存在相位非线性失真 (尤其用双线性变换时)   | 可以实现严格的线性相位                 |
| **计算量/存储**  | 阶数低，计算量和存储可能较小            | 阶数高，计算量和存储可能较大 (但可用FFT优化卷积) |
| **设计灵活性**   | 设计方法成熟，但受限于模拟原型种类         | 设计方法多样，可直接针对数字域指标优化         |

**选择依据**:
*   如果对相位特性要求严格（如线性相位），FIR是首选。
*   如果对计算效率和存储要求苛刻，且能容忍一定的相位非线性，IIR可能是更好的选择。
*   如果要求非常陡峭的过渡带，IIR可以用较低阶数实现。

---

## FIR数字滤波器的实现结构 🛠️

FIR滤波器的实现结构相对简单，因为它们是非递归的。

#### 1. 直接型 (Direct Form) / 横截型 (Transversal) / 卷积型 (Convolutional)
*   **差分方程**:$y(n) = \sum_{i=0}^{N-1} h(i)x(n-i)$
*   **系统函数**:$H(z) = \sum_{n=0}^{N-1} h(n)z^{-n}$
*   **结构**: 一个抽头延迟线结构。输入信号$x(n)$经过一系列单位延迟$z^{-1}$，每个延迟器的输出乘以对应的滤波器系数$h(i)$，然后求和得到输出$y(n)$。
    *   需要$N-1$个延迟单元。
    *   需要$N$个乘法器。
    *   需要$N-1$个加法器。
*   这是最直接、最常见的FIR实现结构。
![](Pic/Pasted%20image%2020250605142108.png)
![](Pic/Pasted%20image%2020250605142340.png)
#### 2. 级联型 (Cascade Form) 
*   系统函数$H(z)$可以分解为若干个（通常是二阶）子系统函数的乘积：
   $H(z) = \prod_{i=0}^{K-1} H_i(z) = A \prod_{i=1}^{M_s} (\alpha_{0i} + \alpha_{1i}z^{-1} + \alpha_{2i}z^{-2})$
    (其中$A$是总增益,$M_s$是二阶节的数目。如果$N-1$是奇数，会有一个一阶节。)
    每个$H_i(z)$对应一对（或一个实）零点。
*   **结构**: 将这些子系统串联起来。每个二阶节可以用直接型实现。
*   **特点**:
    *   **优点**: 提高对系数参数化的灵敏度，即系数的微小变化对零点位置的影响较小。当用有限字长实现时，级联型通常能更好地保持滤波器的频率响应特性。零点可独立调整。
    *   **缺点**: 如果每个二阶节都用完整的直接型，总的乘法器和加法器数量可能比直接型多（虽然通常对于FIR，分子系数就是$h(i)$，级联分解后，每个二阶节的系数是根据零点来的，与直接型的$h(i)$不同）。但主要是为了改善量化效应。
    ![](Pic/Pasted%20image%2020250605142857.png)

#### 3. 线性相位结构 (Linear Phase Structures)
当FIR滤波器具有线性相位时，其冲激响应$h(n)$具有对称性 ($h(n) = \pm h(N-1-n)$)。利用这种对称性，可以减少实现结构中所需的**乘法器数量**。

*   **基本思想**:
    例如，对于Type I ($h(n)=h(N-1-n)$,$N$奇数):
   $y(n) = \sum_{i=0}^{N-1} h(i)x(n-i)$
    可以改写为：
   $y(n) = h(\frac{N-1}{2})x(n-\frac{N-1}{2}) + \sum_{i=0}^{\frac{N-3}{2}} h(i)[x(n-i) + x(n-(N-1-i))]$
    在求和项中，$x(n-i)$和$x(n-(N-1-i))$先相加，然后再乘以共同的系数$h(i)$。
    这样，乘法器的数量可以减少近一半。

*   **四种线性相位类型的结构**:
    幻灯片P113-P116分别展示了Type I, II, III, IV线性相位滤波器的优化结构图。它们都利用了系数对称性，先对相应的输入（或延迟后的输入）进行加/减运算，然后再进行乘法。
    *   乘法器数量约$N/2$。
    *   加法器数量仍为$N-1$。
    ![](Pic/Pasted%20image%2020250605143139.png)
    ![](Pic/Pasted%20image%2020250605143152.png)
    ![](Pic/Pasted%20image%2020250605143215.png)
    ![](Pic/Pasted%20image%2020250605143225.png)
*   这是实现线性相位FIR滤波器的**最有效结构**。
![](Pic/Pasted%20image%2020250605150651.png)
![](Pic/Pasted%20image%2020250605150658.png)
![](Pic/Pasted%20image%2020250605150711.png)
![](Pic/Pasted%20image%2020250605150752.png)
#### 4. 频率取样型结构 (Frequency Sampling Structure)
这种结构直接来源于频率取样法的内插公式：
$H(z) = \underbrace{\left(\frac{1-z^{-N}}{N}\right)}_{H_e(z) \text{ (Comb Filter)}} \cdot \underbrace{\sum_{k=0}^{N-1} \frac{H(k)}{1-W_N^{-k}z^{-1}}}_{\text{Parallel Resonators } H_p(z)}$

*   **结构**:
    1.  **第一子网络$H_e(z) = (1-z^{-N})$**: 这是一个梳状滤波器。其零点均匀分布在单位圆上，位于$z_k = e^{j2\pi k/N}$。它的频率响应在$\omega = 2\pi m/N$(m为整数) 处为零。
    2. ![](Pic/Pasted%20image%2020250605145038.png)
    3. ![](Pic/Pasted%20image%2020250605145109.png)
    4.  **第二子网络$H_p(z) = \sum_{k=0}^{N-1} H_k'(z)$**: 这是一个并联结构，由$N$个一阶IIR谐振器$H_k'(z) = \frac{H(k)/N}{1-W_N^{-k}z^{-1}}$组成。每个谐振器的极点位于$p_k = W_N^{-k} = e^{-j2\pi k/N}$，也在单位圆上。
    5. ![](Pic/Pasted%20image%2020250605145136.png)
    6. ![](Pic/Pasted%20image%2020250605145421.png)
*   **零极点对消之后，保留了 FIR DF 原有的零极点，即在 z = 0 的 N-1 阶级点和有限z平面上的 N-1 个零点**
*   **稳定性问题**:
    *   由于极点和零点都在单位圆上，这种对消对系数的量化误差非常敏感。实际实现中，如果系数有微小偏差，单位圆上的极点可能不会被完全抵消，甚至可能移到单位圆外，导致系统**不稳定**。
    *   **修正方法**: 将梳状滤波器的零点和并联谐振器的极点都从单位圆向内移动一个微小的量，即用$rz^{-1}$($r < 1, r \approx 1$) 替代$z^{-1}$。
       $H(z) \approx \frac{1-r^N z^{-N}}{N} \sum_{k=0}^{N-1} \frac{H(k)}{1-rW_N^{-k}z^{-1}}$
        这样可以提高稳定性，但会略微改变频率响应。
*   **优缺点**:
    *   **优点**: 结构模块化，适合时分复用；在窄带情况下，很多$H(k)$为0，可以简化结构，减少运算；并行结构，计算快，时延小。支路系数$H(k)$直接是频率取样值，控制直观。
    *   **缺点**: 可能需要较多存储器；乘法运算量可能较大；稳定性问题（需修正）。

---

## FIR数字滤波器的总结 回顾

*   FIR滤波器的实现结构包括**直接型、级联型、线性相位结构和频率取样结构**。
*   直接型和级联型与IIR有相似特点（指结构形式）。由于FIR没有非原点极点，所以没有像IIR那样的并联型（基于部分分式展开）。
*   FIR数字滤波器的**线性相位结构**可以减少乘法运算次数，是最常用的FIR数字滤波器实现结构，尤其是在对相位要求严格且希望节省计算资源的场合。
*   频率取样结构提供了一种频域设计的直接实现途径，但在稳定性方面需要特别注意。

---

至此，我们完成了对FIR数字滤波器设计主要内容的学习。希望通过本章的讲解，你对FIR滤波器的原理、设计方法和实现结构有了清晰的认识，并能体会到它在线性相位和稳定性方面的独特优势。在实际应用中，根据具体需求选择合适的设计方法和实现结构至关重要。