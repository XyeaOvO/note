# IIR数字滤波器的实现结构 🧭

我们知道，数字滤波器在信号处理中扮演着至关重要的角色。当谈到IIR（无限冲激响应）数字滤波器时，其实现结构是一个核心话题。为什么呢？因为即使是同一个系统函数 $H(z)$，也可以有多种不同的实现方式，而这些方式会直接影响到滤波器的性能，如稳定性、计算精度、运算速度以及硬件成本。

这一章，我们将一起探索IIR数字滤波器的几种主要实现结构。

---

### 1. 引言：为何需要不同的实现结构？ 🤔

■ 数字滤波器本质上是一个离散时间系统。我们可以用多种数学工具来描述它：
*   差分方程
*   单位冲激响应 $h(n)$
*   系统函数 $H(z)$
	由于描述方式的多样性，自然而然地就引出了不同的实现方法。

■ 💡 **核心思想**：对于同一个系统函数 $H(z)$，其分子和分母多项式可以通过不同的方式进行分解和组合。这种差异使得我们可以构造出多种不同的实现结构。
■  **目标**：选择或设计合适的结构，以满足实际应用中对**稳定性**、**精度**（例如，在有限字长运算中，系数和信号的量化误差影响）以及**运算速度**（例如，乘法器和加法器的数量，以及并行处理的可能性）等方面的特定需求。

---

### 2. IIR数字滤波器实现结构的主要类型 🗺️

根据系统函数 $H(z)$ 的不同分解与组合方式，IIR数字滤波器的实现结构主要可以分为以下几种：

*   **直接型 (Direct Form)**
*   **正准型 (Canonical Form)** (也常称为标准型)
*   **级联型 (Cascade Form)**
*   **并联型 (Parallel Form)**

接下来，我们将逐一深入探讨这些结构。

---

### 3. 直接型 (Direct Form) 🧱

直接型结构是最基本也是最直观的实现方式，它直接来源于滤波器的差分方程或系统函数 $H(z)$。

#### 3.1 从差分方程和系统函数出发

■ **差分方程** 📝：
一个N阶IIR滤波器的通用差分方程可以表示为：
$y(n) = \sum_{i=0}^{M} a_i x(n-i) + \sum_{i=1}^{N} b_i y(n-i)$
(注意：一些教材中，反馈部分的系数可能带有负号，如 $y(n) = \sum a_i x(n-i) - \sum b_i' y(n-i)$，此时 $b_i = -b_i'$)

■ **系统函数** $H(z)$ ⚙️：
对应的系统函数为：
$H(z) = \frac{Y(z)}{X(z)} = \frac{\sum_{i=0}^{M} a_i z^{-i}}{1 - \sum_{i=1}^{N} b_i z^{-i}}$
(这里我们假设分母的常数项为1，如果原始差分方程中 $y(n)$ 的系数不为1，需要先进行归一化。)

*   **结构解读**：
    *   滤波器可以看作由两部分组成：
        1.  **滑动平均部分 (分子部分)**：对应于 $\sum a_i x(n-i)$，这是一个FIR（有限冲激响应）部分，也称为零点部分。
        2.  **递归部分 (分母部分)**：对应于 $\sum b_i y(n-i)$，这是IIR（无限冲激响应）的关键，也称为极点部分。
    *   直接将这个系统函数 $H(z)$ 转换为信号流图，就得到了**直接型结构**。

■ **信号流图** 🎨：
下图展示了一个通用的直接型结构（也常被称为直接I型）：
*   图中的 $z^{-1}$ 表示一个单位延时。
*   圆圈加号 $\bigoplus$ 表示加法器。
*   箭头上的 $a_i$ 和 $b_i$ 表示乘法系数。

![](Pic/Pasted%20image%2020250604104356.png)
*图中 $a_i$ 对应分子系数，$b_i$ 对应分母中 $1-\sum b_i z^{-i}$ 的系数。*

*   **思考** 🤔：上图中的加法器需要 $(N+M+1)$ 个输入。如果 $N$ 和 $M$ 很大，这样的多输入加法器在硬件实现上可能不太实际或效率不高。

#### 3.2 直接I型 (Direct Form I) 🔗

直接I型结构是将系统函数 $H(z)$ 看作两个子系统的级联：
$H(z) = H_1(z) H_2(z) = \left( \sum_{i=0}^{M} a_i z^{-i} \right) \times \left( \frac{1}{1 - \sum_{i=1}^{N} b_i z^{-i}} \right)$

*   **第一网络 ($H_1(z)$)**：一个全零点（FIR）滤波器，实现分子部分。
*   **第二网络 ($H_2(z)$)**：一个全极点滤波器，实现分母的倒数。

■ **信号流图** 🎨：
![](Pic/Pasted%20image%2020250604104620.png)
*输入 $x(n)$ 先经过第一网络（FIR部分），其输出 $y_1(n)$ 再作为第二网络（IIR反馈部分）的输入，得到最终输出 $y(n)$。*

#### 3.3 直接II型 (Direct Form II) 🔄

直接II型结构则是将直接I型中的两个子系统交换顺序：
$H(z) = H_2(z) H_1(z) = \left( \frac{1}{1 - \sum_{i=1}^{N} b_i z^{-i}} \right) \times \left( \sum_{i=0}^{M} a_i z^{-i} \right)$

*   **第一网络 ($H_2(z)$)**：全极点滤波器，先处理输入信号。
*   **第二网络 ($H_1(z)$)**：全零点滤波器，处理第一网络的输出。

■ **信号流图** 🎨：
![](Pic/Pasted%20image%2020250604105155.png)
*输入 $x(n)$ 先经过第一网络（IIR反馈部分），其输出 $y_2(n)$ 再作为第二网络（FIR部分）的输入，得到最终输出 $y(n)$。*

■ **深入理解直接II型**
*   **第一个网络** (IIR部分):
    $Y_2(z) = X(z) + \sum_{i=1}^{N} b_i z^{-i} Y_2(z)$
    $\Rightarrow Y_2(z) (1 - \sum_{i=1}^{N} b_i z^{-i}) = X(z)$
    $\Rightarrow H_2(z) = \frac{Y_2(z)}{X(z)} = \frac{1}{1 - \sum_{i=1}^{N} b_i z^{-i}}$
    时域表达式: $y_2(n) = x(n) + \sum_{i=1}^{N} b_i y_2(n-i)$
*   **第二个网络** (FIR部分):
    $Y(z) = \left( \sum_{i=0}^{M} a_i z^{-i} \right) Y_2(z)$
    $\Rightarrow H_1(z) = \frac{Y(z)}{Y_2(z)} = \sum_{i=0}^{M} a_i z^{-i}$
    时域表达式: $y(n) = \sum_{i=0}^{M} a_i y_2(n-i)$

*   **结构关系** ✨：
    *   直接II型的**第一个网络** (全极点部分) 与直接I型的**第二个网络**结构相同。
    *   直接II型的**第二个网络** (全零点部分) 与直接I型的**第一个网络**结构相同。

---

### 4. 正准型 (Canonical Form) / 标准型 ✨

正准型的核心思想是**最少化延迟单元的数量**。

#### 4.1 正准I型 (Canonical Form I) / 直接II型的优化

■ **观察与优化** (对应幻灯片P7)
回顾直接II型的结构，我们会发现一个巧妙的优化机会：
*   在直接II型中，第一网络（全极点）的输出 $y_2(n)$（及其各阶延迟 $y_2(n-1), y_2(n-2), \dots$）直接作为第二网络（全零点）的输入。
*   这意味着两个网络的延迟链实际上是在操作相同的中间信号 $y_2(n)$。
*   因此，我们可以将这两条看似独立的延迟链**合并为一条共用的延迟链**！

■ **合并效果** 💡：
通过合并，我们可以节省一部分延时单元。具体节省的数量是 $M$ (FIR部分阶数) 和 $N$ (IIR部分阶数)中较小的那一个，即 **节省了 $\min(M, N)$ 个延时单元**。
当 $M=N$ 时，可以节省一半的延时单元。这种使用最少数量延迟单元的结构，就被称为**正准I型结构** (也常称作直接II型的正准型或标准型)。

■ **信号流图** 🎨：
![](Pic/Pasted%20image%2020250604105657.png)
*左图为直接II型，中间绿色框标示了可以合并的延迟单元。右图为合并后的正准I型结构。*

#### 4.2 正准II型 (Canonical Form II) / 转置结构

■ **转置定理 (Transposition Theorem)** 🔄
转置定理是获得新滤波器结构的一种有力工具。对一个信号流图进行转置操作包括：
1.  反转所有支路箭头的方向。
2.  将输入和输出互换。
3.  将原来的加法器节点（求和点）变成信号分支点（引出点），反之亦然。
重要的是，转置后的系统函数与原系统函数保持不变！

■ **从正准I型到正准II型** (对应幻灯片P8)
利用转置定理，我们可以从正准I型结构得到其对偶结构——**正准II型结构**。

■ **信号流图** 🎨：
![](Pic/Pasted%20image%2020250604110151.png)
*左图为正准I型，右图为通过转置定理得到的正准II型结构。*
正准II型也使用了最少数量的延迟单元。

#### 4.3 示例：直接I型与正准I型

![](Pic/Pasted%20image%2020250604110707.png)

#### 4.4 直接型与正准型的缺点 ⚠️

虽然直接型和正准型结构简单直观，但在实际应用中，尤其对于高阶滤波器，它们存在一些显著的缺点：

*   **对系数的灵敏度高**:
    *   系统的频率特性（特别是零极点位置）对滤波器系数的微小变化非常敏感。
    *   在有限字长实现时，系数的量化会导致零极点位置偏离设计值，可能严重影响滤波器性能，甚至导致系统**不稳定**！
    *   这种现象在滤波器阶数 $N$ 较大时尤为突出。
*   **零极点调整不便**:
    *   系数与系统性能（如特定零极点位置）之间的关系不直接，难以独立调整某个零点或极点而不影响其他。
*   **适用性**:
    *   虽然正准型比直接I型节省了延时单元，但当阶数 $N$ 较大时，两者都不是理想的选择，因为上述灵敏度问题依然存在。

为了克服这些缺点，我们引入了级联型和并联型结构。

---

### 5. 级联型 (Cascade Form) 🔗🔗🔗

级联型结构是将总的系统函数 $H(z)$ 分解为若干个低阶（通常是一阶或二阶）子系统函数 $H_k(z)$ 的乘积，然后将这些子系统串联起来。

#### 5.1 系统函数的分解

$H(z) = \frac{\sum_{i=0}^{M} a_i z^{-i}}{1 - \sum_{i=1}^{N} b_i z^{-i}} = A \frac{\prod_{k=1}^{M} (1-c_k z^{-1})}{\prod_{k=1}^{N} (1-d_k z^{-1})}$
其中 $A$ 是增益常数，$c_k$ 是零点，$d_k$ 是极点。

*   **实系数滤波器的零极点特性** 💡：
    如果滤波器的系数 $a_i, b_i$ 都是实数，那么其零点 $c_k$ 和极点 $d_k$ 必须是：
    1.  实数，或者
    2.  共轭复数对。

*   **分组** 🧩：
    我们可以将这些零点和极点进行配对，组合成具有实系数的一阶和二阶子系统：
    *   **一阶子系统 (对应实数零/极点)**：
        $H_k(z) = \frac{1+q_{1k}z^{-1}}{1+p_{1k}z^{-1}}$ (或类似形式)
    *   **二阶子系统 (对应共轭复数零/极点对)**：
        $H_k(z) = \frac{1+\alpha_{1k}z^{-1}+\alpha_{2k}z^{-2}}{1+\beta_{1k}z^{-1}+\beta_{2k}z^{-2}}$

    相应的：
    $H(Z) = A \frac{ \left[ \prod_{i=1}^{M_1} (1-q_i z^{-1}) \right] \left[ \prod_{i=1}^{M_2} (1-\alpha_i z^{-1})(1-\alpha_i^* z^{-1}) \right] }{ \left[ \prod_{i=1}^{N_1} (1-p_i z^{-1}) \right] \left[ \prod_{i=1}^{N_2} (1-\beta_i z^{-1})(1-\beta_i^* z^{-1}) \right] }$
    合并后，得到由实系数的一阶和二阶因式构成的形式：
    $H(Z) = A \frac{ \left[ \prod_{i=1}^{M_1} (1-q_i z^{-1}) \right] \left[ \prod_{i=1}^{M_2} (1+\alpha_{1i}z^{-1}+\alpha_{2i}z^{-2}) \right] }{ \left[ \prod_{i=1}^{N_1} (1-p_i z^{-1}) \right] \left[ \prod_{i=1}^{N_2} (1+\beta_{1i}z^{-1}+\beta_{2i}z^{-2}) \right] }$
    其中 $M = M_1 + 2M_2$，$N = N_1 + 2N_2$。

#### 5.2 级联结构形式

最终，系统函数可以表示为 $L$ 个二阶（或一阶作为特例）子系统的乘积：
$\boxed{ H(z) = A \prod_{k=1}^{L} H_k(z) = A \prod_{k=1}^{L} \frac{1+\alpha_{1k}z^{-1}+\alpha_{2k}z^{-2}}{1+\beta_{1k}z^{-1}+\beta_{2k}z^{-2}} }$
(如果某个 $H_k(z)$ 是一阶的，则 $\alpha_{2k}=0$ 和 $\beta_{2k}=0$。)

*   **实现**:
    $Y(z) = A \cdot H_1(z) \cdot H_2(z) \cdot \ldots \cdot H_L(z) \cdot X(z)$
    这意味着输入信号 $x(n)$ 依次通过 $H_L(z), H_{L-1}(z), \ldots, H_1(z)$ （或任何其他顺序），最后乘以增益 $A$。
    ![](Pic/Pasted%20image%2020250604112355.png)

*   **子系统的实现**:
    每个二阶（或一阶）子系统 $H_k(z)$ 通常采用**正准I型结构**来实现，因为它需要最少的延迟单元。
    对于二阶子系统 $H_k(z) = \frac{1+\alpha_{1k}z^{-1}+\alpha_{2k}z^{-2}}{1+\beta_{1k}z^{-1}+\beta_{2k}z^{-2}}$:
    ![](Pic/Pasted%20image%2020250604112410.png)
    *注意图中反馈系数为 $-\beta_{1k}$ 和 $-\beta_{2k}$，前馈系数为 $1, \alpha_{1k}, \alpha_{2k}$ (假设 $a_{0k}=1$)*

*   **阶数考虑** (N≥M时，通常分解为 $L \approx N/2$ 个二阶节):
    *   若 $N$ (或 $M$，取较大者) 为偶数，则 $L = N/2$ (假设 $N \ge M$)，所有 $H_k(z)$ 均为二阶。
    *   若 $N$ (或 $M$) 为奇数，则 $L = (N+1)/2$，其中会有一个 $H_k(z)$ 是一阶的。

#### 5.3 级联型结构的特点

*   **优点** ✅：
    *   **零极点的独立性 (相对)**：每个子系统 $H_k(z)$ 的零极点相对独立。调整一个子系统的系数主要影响该子系统的零极点，对其他子系统的影响较小。
    *   **降低系数敏感度**：由于每个子系统都是低阶的（一阶或二阶），其零极点对系数的量化误差不如高阶直接型敏感。这使得级联型结构在有限字长实现时性能更稳定。
    *   便于精确实现 $H(z)$ 的特性和调整。

*   **最优化问题 (挑战)** ⚠️：
    虽然级联型有很多优点，但也引入了新的设计考虑：
    1.  **零极点配对**：如何将总的零点和极点合理地配对形成二阶（或一阶）子系统？
    2.  **级联顺序**：这些子系统 $H_k(z)$ 应该以什么顺序级联？
    
    *   **无限精度运算**：理论上，不同的配对和顺序得到的是完全相同的总系统函数 $H(z)$。
    *   **有限字长运算**：实际中，不同的配对和顺序会导致不同的量化噪声和误差累积。
        *   目标是找到一种**最优的配对和排列**，使得累积误差最小。
        *   每级网络产生的误差会传递并影响后续网络。
    *   **一般原则 (经验法则)** 💡：
        *   **配对**：将**最靠近单位圆的极点**与**离它最近的零点**配对在同一个二阶节中。
        *   **顺序**：
            *   一种策略是将具有较大峰值（即极点靠近单位圆）的二阶节放在级联链的**后端** (靠近输出)，以避免信号在中间级过早饱和或动态范围不足。
            *   另一种策略是，先处理掉那些能够衰减输入信号中强分量的节，或者先放置零点在单位圆上的节 (如果有带阻特性)。
            *   一个重要的考虑是避免在任何中间级的输出产生过大的幅频响应峰值，以防止溢出。
        *   **首要原则**：把互相最靠近的零极点配对到一起，以便避免在极点处出现大的幅频响应。

#### 5.4 示例：级联型结构
![](Pic/Pasted%20image%2020250604112930.png)

---

### 6. 并联型 (Parallel Form) ➕➕➕

并联型结构是将总的系统函数 $H(z)$ 通过**部分分式展开 (Partial Fraction Expansion)** 分解为若干个低阶（通常是一阶或二阶）子系统函数 $H_k(z)$ 的和，然后将这些子系统的输出并联相加。

#### 6.1 系统函数的分解

如果系统函数 $H(z)$ 的分母阶数 $N$ 大于或等于分子阶数 $M$ ($N \ge M$)，且分母没有重根，则 $H(z)$ 可以展开为：
$H(z) = \sum_{i=1}^{N_1} \frac{A_i}{1+p_i z^{-1}} + \sum_{i=1}^{N_2} \frac{a_{0i}+a_{1i}z^{-1}}{1+\beta_{1i}z^{-1}+\beta_{2i}z^{-2}} + \left( \sum_{i=0}^{M-N} C_i z^{-i} \text{ (若 } M \ge N \text{ )} \right)$
*   $N = N_1 + 2N_2$ 是总的分母阶数。
*   若 $M<N$, 则 $\sum C_i z^{-i}$ 项不存在 (或仅为 $C_0$ 如果 $M=N-1$ 且该项为常数)。
*   若 $M=N$, 则最后一项为常数 $C_0$。

■ **信号流图** 🎨：
输入信号 $x(n)$ 同时送入各个并联的支路 $H_k(z)$ (以及常数增益 $C_0$ 支路)，各支路的输出再相加得到总输出 $y(n)$。
![](Pic/Pasted%20image%2020250604113908.png)
*图中 $N_1$ 条支路是一阶的，$N_2$ 条支路是二阶的。每个 $H_k(z)$ 也常用正准I型实现。*

#### 6.2 处理多重极点

如果系统函数 $H(z)$ 的分母存在**多重极点** (例如，在 $z = -\beta^{-1}$ 处有 $r$ 重极点)，则部分分式展开会包含如下形式的项：
$\frac{B_1}{1+\beta z^{-1}} + \frac{B_2}{(1+\beta z^{-1})^2} + \ldots + \frac{B_r}{(1+\beta z^{-1})^r}$
这些具有相同极点但不同阶次的项通常会在并联结构中组合成**一条单独的支路**来实现。

例如，
![](Pic/Pasted%20image%2020250604114438.png)

#### 6.3 示例：并联型结构
![](Pic/Pasted%20image%2020250604114450.png)
#### 6.4 并联型结构的特点 

*   **优点** ✅：
    *   **支路独立，误差不累积**：并联形式的各支路是互相独立的，一个支路的量化误差不会传递到其他支路。这使得并联型对于**有限字长效应不那么敏感**，特别是对于极点位置的精度。
    *   **极点独立调整**：可以相对独立地调整每个支路的极点位置（通过修改该支路的系数）。

*   **缺点** ❌：
    *   **零点控制不直接**：并联型的零点是所有支路响应组合的结果，不能像级联型那样直接控制或分配零点到特定支路。总的零点位置较难精确控制。

*   **并联型与级联型对比** 🆚：
    *   它们各有优缺点。
    *   当采用双线性变换法从模拟滤波器 (AF) 设计数字滤波器 (DF) 时，级联型结构的IIR DF系数中，约25%~50%可能为简单的整数 (如0, ±1, ±2)，这使得乘法器数量减少，非常有吸引力。
    *   目前，大多数滤波器设计软件包倾向于生成**级联型**实现结构的系数，而不是并联型，因为级联型实现结构非常流行且在很多方面表现良好。

---

### 7. IIR DF 实现结构总结 🧾

让我们回顾一下几种主要的IIR数字滤波器实现结构：
![](Pic/Pasted%20image%2020250604115944.png)

---

### 8. 综合示例 🛠️ 

![](Pic/Pasted%20image%2020250604120028.png)

---

### 9. 本章小结 🎯

关于IIR滤波器的实现结构，我们总结以下几点：

*   **IIR滤波器的基本特征**：采用**递归型结构**，即结构上带有**反馈环路**。无论是直接型、正准型、级联型还是并联型，都具有反馈回路。
*   **直接型/正准型**：
    *   结构简单直观。
    *   但系统的频率特性对其零极点位置变化（即系数变化）的**灵敏度高**。某个分母系数的改变会影响所有极点，某个分子系数的改变会影响所有零点。不适合高阶滤波器。
*   **级联型**：
    *   将高阶系统分解为多个低阶（通常为二阶）基本节的串联。
    *   每个二阶基本节系数的变化主要影响该子网络的零、极点。
    *   因此**易于准确实现**滤波器的零、极点，并调整滤波器的频率特性。对系数的敏感度较低。
*   **并联型**：
    *   将高阶系统分解为多个低阶基本节的并联。
    *   并联支路**互相独立**，各自的误差互不影响。
    *   可独立地调整**极点位置**，但不能直接控制总的零点。
*   **相位特性**：
    *   IIR数字滤波器的相位特性一般**不是线性**的，不好直接控制。
    *   对相位要求较高时，可能需要额外串联全通滤波器（相位校准网络）进行补偿。

选择合适的实现结构对于保证IIR数字滤波器的性能至关重要，尤其是在资源受限或对精度要求较高的应用中。

---