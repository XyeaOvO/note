**【学习导航：从模拟到数字的桥梁】**

你好！在之前的学习中，我们已经探索了如何设计出性能优良的模拟滤波器，例如巴特沃思、切比雪夫和椭圆滤波器。这些都是在 $s$ 域描述的 $H_a(s)$。然而，我们的最终目标是设计数字滤波器 $H(z)$，用于处理离散的数字信号。

那么，如何从成熟的模拟滤波器设计“借鉴”经验，得到我们想要的数字滤波器呢？本节将为你揭示两种核心的“**模拟滤波器数字化**”技术：

1.  **冲激响应不变法 (Impulse Invariance Method)**：力求数字滤波器的冲激响应是模拟滤波器冲激响应的采样版本。
2.  **双线性变换法 (Bilinear Transform Method)**：一种代数变换，将 $s$ 平面映射到 $z$ 平面，克服冲激响应不变法的一些局限。

理解这两种方法，就像是为模拟世界和数字世界架设起了坚实的桥梁。它们是IIR数字滤波器“模拟原型法”设计的关键“最后一步”。让我们一起深入探索这些巧妙的转换技巧吧！🚀

---

### 4. 模拟滤波器的数字化：搭建 $s$ 域到 $z$ 域的桥梁 🌉

利用模拟滤波器来设计数字滤波器，本质上就是要把 $s$ 平面映射到 $z$ 平面，使得模拟系统函数 $H_a(s)$ 变换成我们所需要的数字滤波器的系统函数 $H(z)$。这种从复变量 $s$ 到复变量 $z$ 之间的映射（变换）关系，必须满足一些基本要求，才能保证设计出的数字滤波器既有效又稳定。

#### 4.1 映射的基本准则 ✨

1.  **频率响应的相似性**: 为了让数字滤波器 $H(z)$ 的频率特性能够“模仿”模拟滤波器 $H_a(s)$ 的频率特性，一个关键的要求是 $s$ 平面的**虚轴 ($s=j\Omega$) 必须映射到 $z$ 平面的单位圆 ($|z|=1$) 上**。因为虚轴是模拟滤波器频率响应的定义域，而单位圆是数字滤波器频率响应的定义域。
2.  **稳定性的保持**: 一个设计良好的因果稳定模拟滤波器 $H_a(s)$（其极点全部在 $s$ 左半平面），经过变换后，应该得到一个因果稳定的数字滤波器 $H(z)$（其极点全部在 $z$ 平面单位圆内部）。即 $s$ 左半平面 ($\text{Re}[s] < 0$) 必须映射到 $z$ 平面的单位圆内部 ($|z| < 1$)。
    $\boxed{ s \text{ 左半平面 (LHP)} \rightarrow z \text{ 平面单位圆内部 } }$
    $\boxed{ s \text{ 平面虚轴 } \rightarrow z \text{ 平面单位圆 } }$

#### 4.2 主要的映射方法概述 🗺️

根据我们希望保留的模拟滤波器和数字滤波器之间的特性不同，主要有以下几种映射方法：

*   **保留冲激响应的形状** $\rightarrow$ **冲激响应不变法 (Impulse Invariance Method)**
*   保留阶跃响应的形状 $\rightarrow$ 阶跃响应不变法 (Step Invariance Method, 本课程不详细展开)
*   **保留从模拟到数字的系统函数代数关系** $\rightarrow$ **双线性变换法 (Bilinear Transform Method)**

我们将重点学习冲激响应不变法和双线性变换法。

### 5. 冲激响应不变法 (Impulse Invariance Method)：时域波形的忠实采样 🕒

冲激响应不变法的核心思想是：我们希望设计出的数字滤波器 $H(z)$，其单位冲激响应 $h(n)$ 是对应模拟滤波器 $H_a(s)$ 的单位冲激响应 $h_a(t)$ 以某个采样周期 $T$ 进行采样，并乘以 $T$（或不乘，取决于定义）得到的。

#### 5.1 数字仿真：模拟行为的离散再现

想象我们有一个模拟滤波器 $H_a(j\Omega)$。如果输入一个连续信号 $x(t)$，它会输出 $y(t)$。现在，我们想用一个数字滤波器 $H(z)$ 来“仿真”这个过程：
*   将 $x(t)$ 采样得到 $x(n) = x(nT)$。
*   将 $x(n)$ 输入数字滤波器 $H(z)$，得到输出 $y_D(n)$。
*   我们希望 $y_D(n)$ 尽可能地等于 $y(t)$ 的采样值 $y(nT)$。

当满足特定条件时，这种仿真就是有效的。

*   **时域推导** (概念性):
    模拟系统的输出是输入与冲激响应的卷积：
    $y_a(t) = x_a(t) * h_a(t) = \int_{-\infty}^{\infty} x_a(\tau) h_a(t-\tau) d\tau$
    如果 $h_a(t)$ 是因果的，$y_a(t) = \int_{0}^{\infty} x_a(t-\tau) h_a(\tau) d\tau$。
    这个积分可以用黎曼和来近似，当采样周期 $T$ 足够小时：
    $y_a(t) \approx T \sum_{k=0}^{\infty} x_a(t-kT) h_a(kT)$
    如果我们对输出 $y_a(t)$ 也进行采样，令 $t=nT$：
    $y_a(nT) \approx T \sum_{k=0}^{\infty} x_a((n-k)T) h_a(kT)$
    现在，我们定义数字滤波器的冲激响应为 $h(k) = T h_a(kT)$，数字输入为 $x(n) = x_a(nT)$。
    那么数字滤波器的输出是：
    $y(n) = x(n) * h(n) = \sum_{k=0}^{\infty} x(n-k) h(k) = \sum_{k=0}^{\infty} x_a((n-k)T) [T h_a(kT)]$
    比较可得，当 $h(n) = T h_a(nT)$ 时，$y(n) \approx y_a(nT)$。这个 $T$ 因子是为了在求和近似积分时保持幅度的一致性。

    $\boxed{ \text{冲激响应不变准则: } h(n) = T \cdot h_a(nT) }$

*   **重要前提**: 上述近似和采样过程依赖于**采样定理**。采样周期 $T$ 必须足够小，以避免 $x_a(t)$ 和 $h_a(t)$ 在采样时发生频谱混叠。

#### 5.2 频域特性：频谱的周期延拓与混叠风险 🎢

我们来看看冲激响应不变准则在频域意味着什么。

*   回忆：对连续时间信号 $h_a(t)$ 进行理想采样得到 $h_s(t) = \sum_{n=-\infty}^{\infty} h_a(nT) \delta(t-nT)$，其傅里叶变换 $H_s(j\Omega)$ 与 $H_a(j\Omega)$ 的关系是：
    $H_s(j\Omega) = \frac{1}{T} \sum_{k=-\infty}^{\infty} H_a(j(\Omega - k\Omega_s))$，其中 $\Omega_s = 2\pi/T$ 是采样角频率。
*   我们的数字滤波器冲激响应是 $h(n) = T h_a(nT)$。其 DTFT (数字角频率 $\omega = \Omega T$) 为 $H(e^{j\omega})$ 或 $H(e^{j\Omega T})$。
    $H(e^{j\Omega T}) = \sum_{n=-\infty}^{\infty} h(n) e^{-j\Omega T n} = \sum_{n=-\infty}^{\infty} [T h_a(nT)] e^{-j\Omega T n} = T \cdot Z\{h_a(nT)\}|_{z=e^{j\Omega T}}$
    将 $h_a(nT)$ 的 Z 变换与 $H_s(j\Omega)$ 联系起来（通过 $z=e^{sT}$，令 $s=j\Omega$），可以得到：
    $\boxed{ H(e^{j\Omega T}) = \sum_{k=-\infty}^{\infty} H_a(j(\Omega - k\Omega_s)) }$
    这意味着数字滤波器的频率响应 $H(e^{j\Omega T})$ 是模拟滤波器频率响应 $H_a(j\Omega)$ 以采样频率 $\Omega_s$ 为周期进行无限延拓叠加而成的。
    *   ![](Pic/Pasted%20image%2020250514120308.png)

*   **频谱混叠 (Aliasing)**:
    *   如果模拟滤波器 $H_a(j\Omega)$ 不是严格带限的，或者其带宽超过了奈奎斯特频率 $\Omega_s/2 = \pi/T$，那么在周期延拓时，相邻的频谱会发生重叠，导致混叠。
    *   ![](Pic/Pasted%20image%2020250514120436.png)
    *   **为了避免混叠**，必须要求模拟滤波器 $H_a(j\Omega)$ 在 $|\Omega| \ge \Omega_s/2$ 时近似为零。
        $\boxed{ \text{抗混叠条件: } H_a(j\Omega) \approx 0 \text{ for } |\Omega| \ge \Omega_s/2 = \pi/T }$
*   **无混叠情况下的关系**:
    如果 $H_a(j\Omega)$ 满足抗混叠条件，则在基带 $(-\Omega_s/2, \Omega_s/2)$ 内（即数字频率 $-\pi < \omega < \pi$）：
    $\boxed{ H(e^{j\omega}) = H_a(j\Omega)|_{\Omega = \omega/T}, \quad \text{for } |\omega| < \pi }$
    这意味着在没有混叠的情况下，数字滤波器的频率响应在主周期内与模拟滤波器的频率响应形状相同（仅有频率轴的线性尺度变换 $\omega = \Omega T$）。

#### 5.3 冲激响应不变法的设计步骤：从 $H_a(s)$ 到 $H(z)$ 🛠️

给定模拟滤波器 $H_a(s)$ 和采样周期 $T$：

1.  **第一步：对 $H_a(s)$ 进行拉普拉斯反变换，求得 $h_a(t)$** (理论步骤，实际操作中常跳过)
    $h_a(t) = \mathcal{L}^{-1}\{H_a(s)\}$
2.  **第二步：对 $h_a(t)$ 进行采样并乘以 $T$，得到 $h(n)$**
    $h(n) = T \cdot h_a(nT)$
3.  **第三步：对 $h(n)$ 进行 $z$ 变换，得到 $H(z)$**
    $H(z) = \mathcal{Z}\{h(n)\} = \mathcal{Z}\{T \cdot h_a(nT)\}$

*   **更实用的方法：部分分式展开法**
    假设模拟滤波器 $H_a(s)$ 是稳定的，并且其分子阶数 $M$ 小于分母阶数 $N$ (这对于物理可实现的滤波器是常见的)。我们可以将其展开为部分分式（假设为单极点）：
    $\boxed{ H_a(s) = \sum_{i=1}^{N} \frac{A_i}{s - s_i} }$
    其中 $s_i$ 是 $H_a(s)$ 的极点， $A_i$ 是对应的留数。
    对应的冲激响应为：
    $h_a(t) = \sum_{i=1}^{N} A_i e^{s_i t} u(t)$
    对其进行采样并乘以 $T$:
    $h(n) = T h_a(nT) = T \sum_{i=1}^{N} A_i e^{s_i nT} u(nT) = \sum_{i=1}^{N} (T A_i) (e^{s_i T})^n u(n)$
    进行 $z$ 变换（利用 $a^n u(n) \leftrightarrow \frac{1}{1-az^{-1}}$）：
    $\boxed{ H(z) = \sum_{i=1}^{N} \frac{T A_i}{1 - e^{s_i T} z^{-1}} }$
    *   **结论**:
        *   模拟滤波器的每个单极点 $s_i$ 映射为数字滤波器的一个极点 $z_i = e^{s_i T}$。
        *   部分分式的系数 $A_i$ 被乘以 $T$ 后成为数字滤波器部分分式的系数。

*   **设计流程图示**:
    $H_a(s) \xrightarrow{\text{部分分式}} \sum \frac{A_i}{s-s_i} \quad \Longrightarrow \quad H(z) = \sum \frac{T A_i}{1-e^{s_i T}z^{-1}}$

#### 5.4 $s$ 平面与 $z$ 平面的映射关系 (冲激响应不变法) 🗺️

由 $z_i = e^{s_i T}$ 可推广得到 $s$ 平面与 $z$ 平面之间的映射关系：
$\boxed{ z = e^{sT} }$
令 $s = \sigma + j\Omega$ 和 $z = r e^{j\omega}$：
$r e^{j\omega} = e^{(\sigma + j\Omega)T} = e^{\sigma T} e^{j\Omega T}$
由此可得：
$\boxed{ r = e^{\sigma T} }$
$\boxed{ \omega = \Omega T }$

*   **映射特性**:
    1.  **$s$ 平面虚轴 ($\sigma=0$)** $\Rightarrow r = e^0 = 1$ $\Rightarrow$ **$z$ 平面单位圆**。
        *   $\omega = \Omega T$。这表明模拟频率 $\Omega$ 与数字频率 $\omega$ 之间是**线性映射关系**。
    2.  **$s$ 左半平面 ($\sigma < 0$)** $\Rightarrow r = e^{\sigma T} < 1$ $\Rightarrow$ **$z$ 平面单位圆内部**。因此，稳定的模拟滤波器会映射为稳定的数字滤波器。
    3.  **$s$ 右半平面 ($\sigma > 0$)** $\Rightarrow r = e^{\sigma T} > 1$ $\Rightarrow$ **$z$ 平面单位圆外部**。
    4.  **多对一映射 (Many-to-One Mapping)**:
        *   由于 $e^{j\Omega T}$ 的周期性， $s$ 平面上虚轴的多个条带会映射到 $z$ 平面的同一个单位圆上。
        *   例如，$\Omega$, $\Omega \pm \Omega_s$, $\Omega \pm 2\Omega_s$, ... 这些不同的模拟频率点，都会因为 $\omega = \Omega T \pmod{2\pi}$ 而映射到相同的数字频率 $\omega$。
        *   整个 $s$ 平面虚轴 ($-\infty < \Omega < \infty$) 被重复地映射到 $z$ 平面单位圆上。 具体来说，$s$ 平面上宽度为 $\Omega_s = 2\pi/T$ 的水平条带（例如，$-\pi/T \le \Omega < \pi/T$）会覆盖整个 $z$ 平面单位圆。
        *   这就是导致频谱混叠的根本原因：如果 $H_a(j\Omega)$ 在一个以上的 $2\pi/T$ 频带内有能量，这些能量就会叠加到 $H(e^{j\omega})$ 的主值区间 $(-\pi, \pi)$。
        *   ![](Pic/Pasted%20image%2020250514165033.png)
        *   为防止频谱混叠，模拟滤波器 $H_a(j\Omega)$ 必须在主频带 $[-\pi/T, \pi/T]$ (即 $[-\Omega_s/2, \Omega_s/2]$) 之外严格限带。

#### 5.5 冲激响应不变法设计数字低通滤波器示例与讨论 📝

*   **给定数字低通滤波器指标**: $\omega_p, \omega_s, A_p, A_s$。
*   **设计过程**:
    1.  **选择采样周期 $T$**: 这是一个关键步骤。$T$ 的选择会影响模拟频率的范围和可能的混叠。通常根据数字频率指标的上限（例如接近 $\pi$ 的 $\omega_s$）来估算，确保 $\Omega_s = 2\pi/T$ 足够大。
    2.  **转换数字频率指标到模拟频率指标**:
        $\Omega_p = \omega_p / T$
        $\Omega_s = \omega_s / T$
        (注意：$A_p, A_s$ 保持不变)
    3.  **设计模拟滤波器 $H_a(s)$**: 根据 $\Omega_p, \Omega_s, A_p, A_s$ 设计一个满足要求的模拟滤波器 (如巴特沃思、切比雪夫等)。
    4.  **将 $H_a(s)$ 展开为部分分式**: $H_a(s) = \sum \frac{A_i}{s-s_i}$。
    5.  **应用冲激响应不变法转换**: $H(z) = \sum \frac{T A_i}{1-e^{s_i T}z^{-1}}$。

*   **示例**:
    利用冲激响应不变法，把 $H_a(s) = \frac{s+1}{s^2+5s+6}$ 转换成数字滤波器 $H(z)$，其中 $T=0.1$s。
    **解**:
    1.  部分分式展开 $H_a(s)$:
        $H_a(s) = \frac{s+1}{(s+2)(s+3)} = \frac{A}{s+2} + \frac{B}{s+3}$
        $A = \frac{-2+1}{-2+3} = -1$
        $B = \frac{-3+1}{-3+2} = \frac{-2}{-1} = 2$
        所以 $H_a(s) = \frac{-1}{s+2} + \frac{2}{s+3}$。
        这里 $s_1 = -2, A_1 = -1$; $s_2 = -3, A_2 = 2$。
    2.  应用转换公式:
        $H(z) = \frac{T A_1}{1-e^{s_1 T}z^{-1}} + \frac{T A_2}{1-e^{s_2 T}z^{-1}}$
        $H(z) = \frac{0.1 \times (-1)}{1-e^{-2 \times 0.1}z^{-1}} + \frac{0.1 \times 2}{1-e^{-3 \times 0.1}z^{-1}}$
        $H(z) = \frac{-0.1}{1-e^{-0.2}z^{-1}} + \frac{0.2}{1-e^{-0.3}z^{-1}}$
        $e^{-0.2} \approx 0.8187$, $e^{-0.3} \approx 0.7408$
        $H(z) = \frac{-0.1}{1-0.8187z^{-1}} + \frac{0.2}{1-0.7408z^{-1}}$
        通分得到：
        $H(z) = \frac{-0.1(1-0.7408z^{-1}) + 0.2(1-0.8187z^{-1})}{(1-0.8187z^{-1})(1-0.7408z^{-1})}$
        $H(z) = \frac{-0.1 + 0.07408z^{-1} + 0.2 - 0.16374z^{-1}}{1 - (0.8187+0.7408)z^{-1} + (0.8187 \times 0.7408)z^{-2}}$
        $H(z) = \frac{0.1 - 0.08966z^{-1}}{1 - 1.5595z^{-1} + 0.6065z^{-2}}$

*   **混叠的影响**:
    当使用冲激响应不变法设计数字巴特沃思低通滤波器时，如果采样周期 $T$ 选取不当（过大），模拟滤波器的带外衰减部分会混叠到数字滤波器的通带和过渡带，导致数字滤波器的性能与期望的模拟滤波器特性在高频处有较大差异。
    *   减小采样周期 $T$ (即提高采样频率 $\Omega_s$) 可以减轻混叠现象，使得数字滤波器的频率响应更逼近模拟滤波器的频率响应。
    *   ![](Pic/Pasted%20image%2020250514170222.png)

#### 5.6 冲激响应不变法的优缺点与适用范围 ⚖️

*   **优点** 👍:
    1.  **设计简单**: 步骤清晰，特别是利用部分分式展开时，转换直观。
    2.  **频率响应的线性映射**: 在无混叠或混叠可忽略的情况下，模拟频率 $\Omega$ 和数字频率 $\omega$ 之间是线性关系 ($\omega = \Omega T$)。这意味着如果模拟滤波器具有良好的相位线性度，数字滤波器也能保持类似的相位特性 (在基带内)。
    3.  冲激响应的形状得以保持（采样意义下）。

*   **缺点** 👎:
    1.  **频谱混叠问题**: 这是最主要的缺点。由于 $s$ 平面到 $z$ 平面的映射是多对一的 ($z=e^{sT}$)，如果模拟滤波器 $H_a(s)$ 不是严格带限的（实际上总是如此），则必然会产生频谱混叠，导致数字滤波器的频率响应失真。
    2.  **仅适用于特定类型的滤波器**: 由于混叠在高频处影响更严重，冲激响应不变法主要适用于那些频率响应在高频处快速衰减的滤波器，如**低通滤波器 (LPF)** 和某些**带通滤波器 (BPF)**。它不适合直接设计高通滤波器 (HPF) 或带阻滤波器 (BSF)，因为这些滤波器的理想响应在 $\Omega=0$ 附近为零，但高频混叠成分会破坏这一点。
    3.  对采样周期 $T$ 的选择敏感。

*   **适用范围**:
    主要用于设计对相位特性有一定要求，且模拟原型在高频处有足够衰减的**低通和带通**数字滤波器。

由于冲激响应不变法的混叠问题，人们寻求一种能够将整个 $s$ 平面虚轴唯一地映射到 $z$ 平面单位圆的方法，这就是双线性变换法。

### 6. 双线性变换法 (Bilinear Transform Method)：无混叠的代数映射  алгебра

双线性变换法是另一种重要的 $s \rightarrow z$ 变换技术，它通过一个代数关系将整个 $s$ 平面映射到整个 $z$ 平面，从而从根本上避免了冲激响应不变法中的频谱混叠问题。

#### 6.1 双线性变换法的基本思想与提出动机 🤔

*   **动机**: 冲激响应不变法的核心问题是频谱混叠，源于 $z=e^{sT}$ 的多对一映射特性。我们希望找到一种映射关系，它能够将 $s$ 平面的整个虚轴 ($-\infty < \Omega < \infty$) **单值地**映射到 $z$ 平面单位圆上的一周 ($-\pi \le \omega < \pi$)。
*   **基本思路**:
    可以想象一个中间步骤：
    1.  将 $s$ 平面 ($s=\sigma+j\Omega$) 映射到一个中间的 $s_1$ 平面 ($s_1 = \sigma_1 + j\Omega_1$)，使得整个 $j\Omega$ 轴被压缩到 $s_1$ 平面的一个有限区间，例如 $j\Omega_1$ 轴的 $[-\pi/T, \pi/T]$。这一步可以通过诸如 $\Omega = A \tan(\frac{\Omega_1 T}{2})$ (这里 $A$ 是常数, $\Omega_1$ 是中间平面频率) 这样的非线性压缩来实现。
    2.  然后，将这个中间 $s_1$ 平面的 $j\Omega_1$ 轴上的 $[-\pi/T, \pi/T]$ 区间通过类似 $z=e^{s_1 T}$ 的关系线性地映射到 $z$ 平面的单位圆。
*   **简化步骤**: 实际上，我们不需要显式地构造中间平面，而是直接找到一个从 $s$ 到 $z$ 的代数关系来实现这种单值映射。

#### 6.2 双线性变换公式的推导：从模拟积分到数字积分 🔄

双线性变换公式可以通过用**梯形积分法则**来近似模拟积分器 $1/s$ 得到。

*   **回顾**: 模拟系统的基本构建块之一是积分器，其系统函数为 $H_I(s) = 1/s$。如果输入为 $x_a(t)$，输出为 $y_a(t) = \int_{-\infty}^{t} x_a(\tau)d\tau$。
    这意味着 $y_a'(t) = x_a(t)$。
*   考虑 $y_a(t)$ 在 $t_1$ 和 $t_2$ 之间的变化：
    $y_a(t_2) - y_a(t_1) = \int_{t_1}^{t_2} x_a(\tau)d\tau$
*   **梯形法则近似**: 如果我们用离散点来近似这个积分，令 $t_1 = (n-1)T$，$t_2 = nT$，则：
    $y_a(nT) - y_a((n-1)T) = \int_{(n-1)T}^{nT} x_a(\tau)d\tau \approx \frac{T}{2} [x_a(nT) + x_a((n-1)T)]$
*   令 $y(n) = y_a(nT)$ 和 $x(n) = x_a(nT)$，上式变为一个差分方程：
    $y(n) - y(n-1) = \frac{T}{2} [x(n) + x(n-1)]$
*   对其进行 $z$ 变换：
    $Y(z) - z^{-1}Y(z) = \frac{T}{2} [X(z) + z^{-1}X(z)]$
    $Y(z)(1 - z^{-1}) = X(z) \frac{T}{2} (1 + z^{-1})$
*   数字积分器的系统函数 $H_D(z) = Y(z)/X(z)$ 为：
    $H_D(z) = \frac{T}{2} \frac{1+z^{-1}}{1-z^{-1}}$
*   我们用这个数字积分器 $H_D(z)$ 来替换模拟积分器 $H_I(s) = 1/s$。即令 $s \leftrightarrow 1/H_D(z)$:
    $\boxed{ s = \frac{2}{T} \frac{1-z^{-1}}{1+z^{-1}} }$
    这就是**双线性变换**公式。反过来，也可以表示为 $z$ 关于 $s$ 的函数：
    $\boxed{ z = \frac{1+sT/2}{1-sT/2} = \frac{2/T + s}{2/T - s} }$

#### 6.3 $s$ 平面与 $z$ 平面的映射关系 (双线性变换法) 🗺️➡️🌍

令 $s = \sigma + j\Omega$ 和 $z = r e^{j\omega}$。

1.  **$s$ 平面虚轴 ($s=j\Omega, \sigma=0$) 的映射**:
    $z = \frac{1+j\Omega T/2}{1-j\Omega T/2}$
    $|z| = \frac{|1+j\Omega T/2|}{|1-j\Omega T/2|} = \frac{\sqrt{1+(\Omega T/2)^2}}{\sqrt{1+(-\Omega T/2)^2}} = 1$
    所以，$s$ 平面的整个虚轴 ($-\infty < \Omega < \infty$) 映射到 $z$ 平面的**单位圆**上。
    其相位（即数字角频率 $\omega$）为：
    $\omega = \arg(z) = \arg(1+j\Omega T/2) - \arg(1-j\Omega T/2)$
    $\omega = \arctan(\Omega T/2) - \arctan(-\Omega T/2) = 2 \arctan(\Omega T/2)$
    $\boxed{ \omega = 2 \arctan(\frac{\Omega T}{2}) }$

2.  **$s$ 左半平面 ($s=\sigma+j\Omega, \sigma < 0$) 的映射**:
    $z = \frac{2/T + s}{2/T - s} = \frac{(2/T + \sigma) + j\Omega}{(2/T - \sigma) - j\Omega}$
    $|z|^2 = \frac{(2/T + \sigma)^2 + \Omega^2}{(2/T - \sigma)^2 + \Omega^2}$
    由于 $\sigma < 0$，$2/T + \sigma < 2/T - \sigma$ (假设 $T>0$ 且 $2/T > |\sigma|$，这是普遍情况)。
    如果 $2/T + \sigma > 0$ (即 $\sigma > -2/T$)，则 $(2/T + \sigma)^2 < (2/T - \sigma)^2$，所以 $|z|^2 < 1$, 即 $|z|<1$。
    如果 $2/T + \sigma < 0$ (即 $\sigma < -2/T$)，则 $|2/T + \sigma| > |2/T - \sigma|$ (因为 $2/T-\sigma$ 更正)，但符号相反，$(2/T+\sigma)^2$ 仍可能小于 $(2/T-\sigma)^2$。
    更直接地看，如果 $s$ 在 LHP ($\sigma < 0$)，则 $sT/2$ 的实部为负。
    $z = \frac{1+sT/2}{1-sT/2}$。令 $P = sT/2 = \sigma' + j\Omega'$，其中 $\sigma' < 0$。
    $z = \frac{1+P}{1-P}$。$|z| = \frac{|1+P|}{|1-P|} = \frac{\sqrt{(1+\sigma')^2 + (\Omega')^2}}{\sqrt{(1-\sigma')^2 + (\Omega')^2}}$。
    因为 $\sigma' < 0$, $1+\sigma' < 1-\sigma'$ (如果 $1+\sigma'>0$) 或 $|1+\sigma'| < |1-\sigma'|$ (一般情况)。所以 $(1+\sigma')^2 < (1-\sigma')^2$。
    因此，$\boxed{ |z| < 1 \text{ for } \sigma < 0 }$。
    $s$ 左半平面映射到 $z$ 平面单位圆内部，保证了稳定性的传递。

3.  **$s$ 右半平面 ($\sigma > 0$)** $\Rightarrow |z| > 1$ ($z$ 平面单位圆外部)。

*   **关键特性总结**:
    *   $s$ 平面虚轴 $\iff$ $z$ 平面单位圆
    *   $s$ 平面左半边 $\iff$ $z$ 平面单位圆内 (稳定区域映射到稳定区域)
    *   $s$ 平面右半边 $\iff$ $z$ 平面单位圆外
    *   **单值映射 (One-to-One Mapping)**: $s$ 平面的整个虚轴 $j\Omega$ ($-\infty < \Omega < \infty$) 被唯一地映射到 $z$ 平面单位圆上的一周 ($-\pi \le \omega < \pi$)。**这从根本上消除了频谱混叠现象。**

#### 6.4 频率映射与频率畸变：非线性的代价 📉 warping

虽然双线性变换解决了混叠问题，但它引入了另一种效应：**频率的非线性映射 (Frequency Warping)**。

*   模拟角频率 $\Omega$ 和数字角频率 $\omega$ 之间的关系是：
    $\boxed{ \omega = 2 \arctan(\frac{\Omega T}{2}) }$
    或者反过来：
    $\boxed{ \Omega = \frac{2}{T} \tan(\frac{\omega}{2}) }$
    这是一个非线性关系，如下图所示：
    ![](Pic/Pasted%20image%2020250514175732.png)

*   **频率畸变的特点**:
    1.  **低频段近似线性**: 当 $\omega \to 0$ 时，$\tan(\omega/2) \approx \omega/2$，所以 $\Omega \approx \frac{2}{T} \frac{\omega}{2} = \frac{\omega}{T}$。即 $\omega \approx \Omega T$。在低频区域，映射关系近似线性，与冲激响应不变法类似。
    2.  **高频段严重压缩**: 随着 $\omega$ 接近 $\pm\pi$，$\tan(\omega/2)$ 趋向于 $\pm\infty$，导致 $\Omega$ 轴的高频部分被严重压缩映射到 $\omega$ 轴靠近 $\pm\pi$ 的区域。
    3.  **后果**: 如果直接将模拟滤波器的截止频率 $\Omega_p, \Omega_s$ 用于设计，然后通过双线性变换得到数字滤波器，那么数字滤波器的实际截止频率 $\omega_p', \omega_s'$ 将不等于 $\Omega_p T, \Omega_s T$，而是会发生畸变。
        例如，如果 $\Omega_p / \Omega_s = k$，则变换后的 $\omega_p' / \omega_s'$ 一般不等于 $k$。这意味着滤波器的过渡带相对宽度会发生变化。

#### 6.5 频率预畸变 (Frequency Pre-warping)：校正数字滤波器的关键频率点 🎯

为了使设计出的数字滤波器在**指定的数字频率点**（如 $\omega_p, \omega_s$）具有期望的特性（如衰减 $A_p, A_s$），我们需要对模拟滤波器的设计指标进行“预先校正”或“预畸变”。

*   **预畸变过程**:
    1.  **确定数字滤波器的关键频率指标**: $\omega_p, \omega_s$ (以及其他如带通/带阻的多个边缘频率)。
    2.  **使用频率映射的反函数计算预畸变的模拟频率**:
        对于每个数字关键频率 $\omega_d$, 计算对应的预畸变模拟频率 $\Omega_a$:
        $\boxed{ \Omega_a = \frac{2}{T} \tan(\frac{\omega_d}{2}) }$
        例如，预畸变的模拟通带截止频率 $\Omega_{ap} = \frac{2}{T} \tan(\frac{\omega_p}{2})$，
        预畸变的模拟阻带起始频率 $\Omega_{as} = \frac{2}{T} \tan(\frac{\omega_s}{2})$。
    3.  **使用预畸变的模拟频率设计模拟滤波器**: 用 $\Omega_{ap}, \Omega_{as}$ (以及不变的 $A_p, A_s$) 作为模拟滤波器的设计指标，设计出 $H_a(s)$。
    4.  **应用双线性变换**: 将 $H_a(s)$ 通过 $s = \frac{2}{T} \frac{1-z^{-1}}{1+z^{-1}}$ 变换得到数字滤波器 $H(z)$。
        这样，当 $s=j\Omega_{ap}$ 时，会映射到 $z=e^{j\omega_p}$，从而保证数字滤波器在 $\omega_p$ 处具有设计指标。

*   **设计流程 (含预畸变)**:
    1.  给定数字滤波器指标: 类型, $\omega_p, \omega_s, A_p, A_s$, (采样频率 $f_s$ 或周期 $T=1/f_s$)
    2.  **频率预畸变**: $\Omega_{ap} = \frac{2}{T}\tan(\frac{\omega_p}{2})$, $\Omega_{as} = \frac{2}{T}\tan(\frac{\omega_s}{2})$
    3.  设计模拟滤波器 $H_a(s)$ (例如巴特沃思、切比雪夫) 使用 $\Omega_{ap}, \Omega_{as}, A_p, A_s$。
    4.  将 $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$ 代入 $H_a(s)$ 得到 $H(z) = H_a(s)|_{s=\frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}}$。

#### 6.6 双线性变换法设计示例 💻

*   **示例1 (来自PDF P32)**:
    利用双线性变换，把 $H_a(s) = \frac{s+1}{s^2+5s+6}$ 转换成数字滤波器 $H(z)$，其中 $T=1$。
    **解**:
    $H(z) = H_a(s)|_{s=\frac{2(1-z^{-1})}{1(1+z^{-1})}}$
    $s = 2\frac{1-z^{-1}}{1+z^{-1}}$
    $H(z) = \frac{2\frac{1-z^{-1}}{1+z^{-1}} + 1}{(2\frac{1-z^{-1}}{1+z^{-1}})^2 + 5(2\frac{1-z^{-1}}{1+z^{-1}}) + 6}$
    分子: $\frac{2(1-z^{-1}) + (1+z^{-1})}{1+z^{-1}} = \frac{2-2z^{-1}+1+z^{-1}}{1+z^{-1}} = \frac{3-z^{-1}}{1+z^{-1}}$
    分母: $\frac{4(1-z^{-1})^2 + 10(1-z^{-1})(1+z^{-1}) + 6(1+z^{-1})^2}{(1+z^{-1})^2}$
    $= \frac{4(1-2z^{-1}+z^{-2}) + 10(1-z^{-2}) + 6(1+2z^{-1}+z^{-2})}{(1+z^{-1})^2}$
    $= \frac{4-8z^{-1}+4z^{-2} + 10-10z^{-2} + 6+12z^{-1}+6z^{-2}}{(1+z^{-1})^2}$
    $= \frac{(4+10+6) + (-8+12)z^{-1} + (4-10+6)z^{-2}}{(1+z^{-1})^2} = \frac{20 + 4z^{-1} + 0z^{-2}}{(1+z^{-1})^2}$
    $H(z) = \frac{(3-z^{-1})/(1+z^{-1})}{(20+4z^{-1})/(1+z^{-1})^2} = \frac{(3-z^{-1})(1+z^{-1})}{20+4z^{-1}} = \frac{3+3z^{-1}-z^{-1}-z^{-2}}{20+4z^{-1}} = \frac{3+2z^{-1}-z^{-2}}{20+4z^{-1}}$

*   **示例2: 带预畸变的巴特沃思低通滤波器设计 (来自PDF P39-P40)**
    设计一个数字低通滤波器，要求 3dB 截止频率为 $\omega_p = 0.2\pi$，频率 $\omega_s = 0.5\pi$ 处阻带衰减至少为 $A_s = 15$dB。系统采样频率 $f_s=500$Hz ($T=1/500 = 0.002$s)。用双线性变换法设计最低阶巴特沃思滤波器。
    **解**:
    1.  数字指标: $A_p=3$dB (因为是3dB截止频率), $\omega_p=0.2\pi$, $A_s=15$dB, $\omega_s=0.5\pi$, $T=0.002$s。
    2.  频率预畸变:
        $\Omega_{ap} = \frac{2}{T}\tan(\frac{\omega_p}{2}) = \frac{2}{0.002}\tan(\frac{0.2\pi}{2}) = 1000 \tan(0.1\pi) \approx 1000 \times 0.3249 = 324.9$ rad/s
        $\Omega_{as} = \frac{2}{T}\tan(\frac{\omega_s}{2}) = \frac{2}{0.002}\tan(\frac{0.5\pi}{2}) = 1000 \tan(0.25\pi) = 1000 \times 1 = 1000$ rad/s
    3.  设计模拟巴特沃思滤波器:
        *   阶数 $N \ge \frac{\log_{10}[(10^{0.1A_s}-1)/(10^{0.1A_p}-1)]}{2 \log_{10}(\Omega_{as}/\Omega_{ap})} = \frac{\log_{10}[(10^{1.5}-1)/(10^{0.3}-1)]}{2 \log_{10}(1000/324.9)} \approx \frac{\log_{10}(30.62/0.995)}{2 \log_{10}(3.077)} \approx \frac{1.488}{2 \times 0.488} \approx 1.52$
           所以取 $N=2$。 (直接查图得 N=2，$\lambda_s = \Omega_{as}/\Omega_{ap} \approx 3.07$)
        *   由于 $A_p=3$dB，模拟巴特沃思滤波器的 -3dB 截止频率 $\Omega_c = \Omega_{ap} = 324.9$ rad/s。
        *   归一化二阶巴特沃思原型 $H_{LP}(p) = \frac{1}{p^2 + \sqrt{2}p + 1} = \frac{1}{p^2+1.414p+1}$ (PDF P40)。
        *   反归一化: $H_a(s) = H_{LP}(s/\Omega_c) = \frac{1}{(s/\Omega_c)^2 + 1.414(s/\Omega_c) + 1} = \frac{\Omega_c^2}{s^2 + 1.414\Omega_c s + \Omega_c^2}$
            $H_a(s) = \frac{(324.9)^2}{s^2 + 1.414(324.9)s + (324.9)^2} = \frac{105550}{s^2 + 459.4s + 105550}$
            $H(s) = \frac{1}{1+1.414(s/\Omega_p) + (s/\Omega_p)^2} = \frac{1}{1+1.414(s/324.9)+(s/324.9)^2} = \frac{1}{1+0.00435s+0.00000947s^2}$ 分子为1的形式。)
    4.  应用双线性变换 $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}} = 1000\frac{1-z^{-1}}{1+z^{-1}}$:
        代入 $H_a(s) = \frac{1}{1+1.414(s/\Omega_p)+(s/\Omega_p)^2}$  (使用PDF P40的归一化形式，其中$\Omega_p = 324.9$ rad/s 作为3dB点)
        $H(z) = \frac{1}{1 + 1.414 (\frac{1000(1-z^{-1})/(1+z^{-1})}{324.9}) + (\frac{1000(1-z^{-1})/(1+z^{-1})}{324.9})^2}$
        $H(z) = \frac{1}{1 + 1.414 \times 3.077 \frac{1-z^{-1}}{1+z^{-1}} + (3.077 \frac{1-z^{-1}}{1+z^{-1}})^2}$
        $H(z) = \frac{1}{1 + 4.35 \frac{1-z^{-1}}{1+z^{-1}} + 9.47 (\frac{1-z^{-1}}{1+z^{-1}})^2}$
        通分 $(1+z^{-1})^2$:
        $H(z) = \frac{(1+z^{-1})^2}{(1+z^{-1})^2 + 4.35(1-z^{-1})(1+z^{-1}) + 9.47(1-z^{-1})^2}$
        $H(z) = \frac{1+2z^{-1}+z^{-2}}{(1+2z^{-1}+z^{-2}) + 4.35(1-z^{-2}) + 9.47(1-2z^{-1}+z^{-2})}$
        $H(z) = \frac{1+2z^{-1}+z^{-2}}{(1+4.35+9.47) + (2-18.94)z^{-1} + (1-4.35+9.47)z^{-2}}$
        $H(z) = \frac{1+2z^{-1}+z^{-2}}{14.82 - 16.94z^{-1} + 6.12z^{-2}}$
        $H(z) = \frac{1/14.82 (1+2z^{-1}+z^{-2})}{1 - (16.94/14.82)z^{-1} + (6.12/14.82)z^{-2}}$
        $H(z) = \frac{0.0675 (1+2z^{-1}+z^{-2})}{1 - 1.143z^{-1} + 0.413z^{-2}} = \frac{0.0675+0.135z^{-1}+0.0675z^{-2}}{1 - 1.143z^{-1} + 0.413z^{-2}}$
        (与PDF P40 $\frac{0.0679+0.1359z^{-1}+0.0679z^{-2}}{1-1.1508z^{-1}+0.4226z^{-2}}$ 系数略有差异，主要源于中间步骤的tan和$\sqrt{2}$的取值精度。)

#### 6.7 双线性变换法的优缺点与广泛应用 🌟

*   **优点** 👍:
    1.  **无频谱混叠**: $s$ 虚轴与 $z$ 单位圆之间是一一映射，根本上避免了混叠失真。
    2.  **代数替换简单**: 将 $H_a(s)$ 中的 $s$ 直接用 $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$ 替换即可，计算相对直接。
    3.  **稳定性保持**: 稳定的 $H_a(s)$ (LHP 极点) 确保会转换为稳定的 $H(z)$ (单位圆内极点)。
    4.  **适用范围广**: 对滤波器类型没有限制，可以直接用于设计低通、高通、带通、带阻等各种类型的数字滤波器，只要模拟原型存在。
    5.  易于获得数字滤波器的幅频特性：如果已知模拟滤波器的 $|H_a(j\Omega)|$，只需将 $\Omega = \frac{2}{T}\tan(\frac{\omega}{2})$ 代入即可得到 $|H(e^{j\omega})|$。

*   **缺点** 👎:
    1.  **非线性频率畸变**: $\omega = 2\arctan(\Omega T/2)$ 的关系导致频率轴的非线性压缩。这会使得数字滤波器的相位响应相对于模拟滤波器发生畸变，通常不保持线性相位。
    2.  **需要频率预畸变**: 为了在特定数字频率点获得期望的特性，必须进行频率预畸变，这增加了设计步骤。

*   **广泛应用**:
    由于其无混叠和适用性广的优点，**双线性变换法是设计IIR数字滤波器最常用和最重要的方法**。虽然存在频率畸变，但可以通过预畸变来精确控制关键频率点（如截止频率）。对于许多幅度特性是主要考量的应用，双线性变换法是首选。

### 7. 一般数字低通、高通、带通和带阻 IIR DF 的设计 (基于模拟原型和频率变换) 🔄✨

我们已经学习了如何设计模拟低通原型 (如巴特沃思、切比雪夫)，以及如何将模拟滤波器 $H_a(s)$ 转换为数字滤波器 $H(z)$ (冲激响应不变法、双线性变换法)。现在，我们将这些知识整合起来，形成一个设计任意类型 (LP, HP, BP, BS) IIR 数字滤波器的完整流程。

核心思想是：
**数字指标 $\xrightarrow{\text{预畸变}}$ 模拟指标 $\xrightarrow{\text{频率变换}}$ 模拟低通原型指标 $\xrightarrow{\text{设计}}$ 模拟低通原型 $H_{LP}(p)$ $\xrightarrow{\text{反频率变换}}$ 目标模拟滤波器 $H_a(s)$ $\xrightarrow{s \to z \text{变换}}$ 目标数字滤波器 $H_d(z)$**

#### 7.1 设计流程概述 (采用双线性变换法和模拟域频率变换)

假设我们要设计一个目标数字滤波器 $H_d(z)$ (类型为LP, HP, BP, 或 BS)，其数字技术指标为：
*   通带边缘频率: $\omega_{p}$ (或 $\omega_{p1}, \omega_{p2}$ for BP/BS)
*   阻带边缘频率: $\omega_{s}$ (或 $\omega_{s1}, \omega_{s2}$ for BP/BS)
*   通带最大衰减: $A_p$ (dB)
*   阻带最小衰减: $A_s$ (dB)
*   采样周期 $T$ (或采样频率 $f_s = 1/T$)

**步骤如下**:

1.  **第一步：数字指标的频率预畸变** 📏
    使用双线性变换的频率映射关系，将所有数字域的关键频率点 $\omega_k$ 转换为对应的预畸变模拟频率点 $\Omega_k$:
    $\boxed{ \Omega_k = \frac{2}{T} \tan(\frac{\omega_k}{2}) }$
    得到预畸变的模拟指标：$\Omega_p', \Omega_s'$ (for LP/HP) 或 $\Omega_{p1}', \Omega_{p2}', \Omega_{s1}', \Omega_{s2}'$ (for BP/BS)。衰减指标 $A_p, A_s$ 保持不变。

2.  **第二步：(仅对BP/BS) 检查与调整几何对称性** 📐
    *   对于带通(BPF)和带阻(BSF)滤波器，标准的模拟频率变换公式要求滤波器指标具有**几何对称性**。
    *   **BPF**: 计算通带几何中心 $\Omega_0^2 = \Omega_{p1}' \Omega_{p2}'$。检查阻带是否对称: $\Omega_{s1}' \Omega_{s2}' \stackrel{?}{=} \Omega_0^2$。
        若不对称，按笔记 “第四章 IIR数字滤波器的设计（二）.md” 中 9.1 节的方法调整**阻带**边缘频率 $\Omega_{s1}', \Omega_{s2}'$ 中的一个或两个，得到新的 $\bar{\Omega}_{s1}, \bar{\Omega}_{s2}$，使得 $\bar{\Omega}_{s1}\bar{\Omega}_{s2} = \Omega_0^2$ 且原始阻带要求被覆盖。
    *   **BSF**: 计算阻带几何中心 $\Omega_0^2 = \Omega_{s1}' \Omega_{s2}'$。检查通带是否对称: $\Omega_{p1}' \Omega_{p2}' \stackrel{?}{=} \Omega_0^2$。
        若不对称，按笔记 “第四章 IIR数字滤波器的设计（二）.md” 中 9.1 节的方法调整**通带**边缘频率 $\Omega_{p1}', \Omega_{p2}'$ 中的一个或两个，得到新的 $\bar{\Omega}_{p1}, \bar{\Omega}_{p2}$，使得 $\bar{\Omega}_{p1}\bar{\Omega}_{p2} = \Omega_0^2$ 且原始通带要求被满足。

3.  **第三步：计算归一化模拟低通原型 LPF 的指标** 📉
    *   将调整后的（或原始的LP/HP）预畸变模拟指标转换为对一个**归一化模拟低通原型 $H_{LP}(p)$** (其通带截止频率 $\lambda_p=1$) 的要求。
    *   **通带衰减 $A_p$ 和阻带衰减 $A_s$ 保持不变**。
    *   **计算原型 LPF 的归一化阻带起始频率 $\lambda_s$**:
        (参考笔记 “第四章 IIR数字滤波器的设计（二）.md” 第9节的频率变换公式表，使用调整后的预畸变模拟频率)
        *   **LPF' (新低通)**: $\lambda_s = \Omega_s' / \Omega_p'$
        *   **HPF**: $\lambda_s = \Omega_p' / \Omega_s'$
        *   **BPF**: $\lambda_s = (\bar{\Omega}_{s2} - \bar{\Omega}_{s1}) / (\Omega_{p2}' - \Omega_{p1}')$.
            (其中 $\bar{\Omega}_{s1}, \bar{\Omega}_{s2}$ 是调整后满足对称性的阻带边沿，$\Omega_{p1}', \Omega_{p2}'$ 是预畸变后的通带边沿)
        *   **BSF**: $\lambda_s = (\Omega_{p2}' - \Omega_{p1}') / (\bar{\Omega}_{s2} - \bar{\Omega}_{s1})$.
            (其中 $\Omega_{p1}', \Omega_{p2}'$ 是预畸变后的通带边沿 -- 可能需要调整以满足对称性，若如此则为 $\bar{\Omega}_{p1}, \bar{\Omega}_{p2}$。 $\bar{\Omega}_{s1}, \bar{\Omega}_{s2}$ 是调整后满足对称性的阻带边沿。)
            PDF P45 的表格给出了更直接的（但可能需要调整的）$\lambda_s$ 公式。

4.  **第四步：设计归一化模拟低通原型 $H_{LP}(p)$** ⚙️
    *   根据 $A_p, A_s, \lambda_s=1, \lambda_s$ (由上一步计算得到)，选择一种逼近方法 (如巴特沃思、切比雪夫I型)。
    *   确定原型 LPF 的阶数 $N$。
    *   计算或查表得到 $H_{LP}(p)$ 的表达式 (通常分子为常数，分母为 $p$ 的多项式)。

5.  **第五步：进行模拟域的频率变换，得到目标模拟滤波器 $H_a(s)$** 🔄
    *   根据目标滤波器类型，选择合适的从归一化低通原型频率 $p$ 到实际模拟频率 $s$ 的变换公式 $p=q(s)$。
        (参考笔记 “第四章 IIR数字滤波器的设计（二）.md” 第9节的频率变换表)
        *   **LPF'**: $p = s / \Omega_p'$ (这里的 $\Omega_p'$ 是预畸变后的通带截止频率)
        *   **HPF**: $p = \Omega_p' / s$ (这里的 $\Omega_p'$ 是预畸变后的通带截止频率)
        *   **BPF**: $p = \frac{s^2 + \Omega_0^2}{B s}$, 其中 $\Omega_0^2 = \Omega_{p1}'\Omega_{p2}'$, $B = \Omega_{p2}' - \Omega_{p1}'$ (使用预畸变并满足几何对称的频率)
        *   **BSF**: $p = \frac{B s}{s^2 + \Omega_0^2}$, 其中 $\Omega_0^2 = \Omega_{s1}'\Omega_{s2}'$, $B = \Omega_{p2}' - \Omega_{p1}'$ (使用预畸变并满足几何对称的频率)
    *   将 $p=q(s)$ 代入 $H_{LP}(p)$ 得到 $H_a(s) = H_{LP}(p)|_{p=q(s)}$。

6.  **第六步：应用双线性变换，得到目标数字滤波器 $H_d(z)$** 🏁
    将 $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$ 代入 $H_a(s)$ 的表达式中，化简得到最终的数字滤波器系统函数 $H_d(z)$。
    $\boxed{ H_d(z) = H_a(s)|_{s=\frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}} }$

#### 7.2 设计示例：数字巴特沃思带通滤波器📊

**问题**: 用双线性变换法设计一个数字巴特沃思带通滤波器。给定采样频率 $f_s=2000$Hz ($T=1/2000=0.0005$s)。
数字指标:
*   通带: $300\text{Hz} \sim 400\text{Hz}$ ($f_{p1}=300, f_{p2}=400$)
*   通带衰减 $A_p \le 3$dB
*   阻带: $f \le 200\text{Hz}$ ($f_{s1}=200$) 和 $f \ge 500\text{Hz}$ ($f_{s2}=500$)
*   阻带衰减 $A_s \ge 18$dB (PDF中是18dB)

**解**:
1.  **数字角频率指标**:
    $\omega_{p1} = 2\pi f_{p1}/f_s = 2\pi (300/2000) = 0.3\pi$
    $\omega_{p2} = 2\pi f_{p2}/f_s = 2\pi (400/2000) = 0.4\pi$
    $\omega_{s1} = 2\pi f_{s1}/f_s = 2\pi (200/2000) = 0.2\pi$
    $\omega_{s2} = 2\pi f_{s2}/f_s = 2\pi (500/2000) = 0.5\pi$

2.  **频率预畸变 ($T=0.0005$s, $2/T = 4000$)**:
    $\Omega_{p1}' = 4000 \tan(\omega_{p1}/2) = 4000 \tan(0.15\pi) \approx 2038.1$ rad/s
    $\Omega_{p2}' = 4000 \tan(\omega_{p2}/2) = 4000 \tan(0.2\pi) \approx 2906.2$ rad/s
    $\Omega_{s1}' = 4000 \tan(\omega_{s1}/2) = 4000 \tan(0.1\pi) \approx 1299.7$ rad/s
    $\Omega_{s2}' = 4000 \tan(\omega_{s2}/2) = 4000 \tan(0.25\pi) = 4000.0$ rad/s

3.  **检查几何对称性 (BPF)**:
    通带几何中心频率平方: $\Omega_0^2 = \Omega_{p1}' \Omega_{p2}' = 2038.1 \times 2906.2 \approx 5923126$
    $\Omega_0 \approx 2433.7$ rad/s
    阻带几何特性: $\Omega_{s1}' \Omega_{s2}' = 1299.7 \times 4000 = 5198800$
    由于 $\Omega_{s1}' \Omega_{s2}' (=5198800) < \Omega_0^2 (=5923126)$，阻带不满足几何对称，且相对靠内。
    需要调整阻带边缘。PDF P47选择调整 $\Omega_{s1}'$: 计算新的 $\bar{\Omega}_{s1} = \Omega_0^2 / \Omega_{s2}' = 5923126 / 4000 \approx 1480.8$ rad/s。
    (这里PDF的逻辑是 $\Omega_{s1}'\Omega_{s2}' > \Omega_0^2$ (实际是小于), 若用原文 $\bar{\Omega}_{s1} = \Omega_{p1}'\Omega_{p2}'/\Omega_{s2}$，用 $\bar{\Omega}_{s1}$ 代替 $\Omega_{s1}$。
    另一种调整方法：保持阻带衰减要求更严格的一侧，调整另一侧。例如，$\Omega_{as1} = |\Omega_{s1}' - \Omega_0|$ vs $\Omega_{as2}=|\Omega_{s2}'-\Omega_0|$。
    按照PDF的调整 $\bar{\Omega}_{s1} = 1480.8$ rad/s。 (PDF P47写 $\bar{\Omega}_{s1} > \Omega_{s1}'$，则用 $\bar{\Omega}_{s1}$ 代替 $\Omega_{s1}'$)
    这里PDF中写"用 $\bar{\Omega}_{s1}$ 值代替 $\Omega_{s1}$ 值"，但它的计算是 $\Omega_{s1} = \Omega_{p1}\Omega_{p2}/\Omega_{s2}$。
    所以，新的阻带边沿: $\bar{\Omega}_{s1} = 1480.8$ rad/s, $\Omega_{s2}' = 4000$ rad/s.

4.  **计算原型 LPF 指标**: $A_p=3$dB, $A_s=18$dB.
    通带带宽 $B_p = \Omega_{p2}' - \Omega_{p1}' = 2906.2 - 2038.1 = 868.1$ rad/s.
    调整后的阻带宽度 $B_s = \Omega_{s2}' - \bar{\Omega}_{s1} = 4000 - 1480.8 = 2519.2$ rad/s.
    $\lambda_s = B_s / B_p = 2519.2 / 868.1 \approx 2.902$ (PDF P48 一致).

5.  **设计原型 LPF $H_{LP}(p)$**:
    对于巴特沃思滤波器，$N \ge \frac{\log_{10}[(10^{0.1A_s}-1)/(10^{0.1A_p}-1)]}{2\log_{10}(\lambda_s)}$
    $N \ge \frac{\log_{10}[(10^{1.8}-1)/(10^{0.3}-1)]}{2\log_{10}(2.902)} = \frac{\log_{10}(62.099/0.9952)}{2 \times 0.4627} = \frac{1.795}{0.9254} \approx 1.9397$
    所以取 $N=2$。
    归一化二阶巴特沃思 LPF ($A_p=3$dB 时，$\lambda_p=1$ 就是-3dB点):
    $H_{LP}(p) = \frac{1}{p^2 + \sqrt{2}p + 1} = \frac{1}{p^2+1.414p+1}$ (PDF P48)。

6.  **模拟域频率变换 (LPF to BPF)**:
    $p = \frac{s^2+\Omega_0^2}{B_p s} = \frac{s^2+5923126}{868.1 s}$
    将此代入 $H_{LP}(p)$ 得到 $H_a(s) = H_{BP}(s)$ (PDF P48 给出了展开后的结果)。
    $H_{BP}(s) = \frac{7.5360 \times 10^5 s^2}{s^4 + 1.2277 \times 10^3 s^3 + 1.2600 \times 10^7 s^2 + 7.2717 \times 10^9 s + 3.5083 \times 10^{13}}$

7.  **双线性变换**:
    将 $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}} = 4000 \frac{1-z^{-1}}{1+z^{-1}}$ 代入 $H_{BP}(s)$。
    最终得到 (来自PDF P48):
    $H_d(z) = \frac{0.0213 - 0.0426z^{-2} + 0.0213z^{-4}}{1 - 1.6303z^{-1} + 2.2183z^{-2} - 1.2919z^{-3} + 0.6320z^{-4}}$

---

**本章小结与展望**:
我们已经系统学习了IIR数字滤波器设计的两种核心模拟-数字转换方法：冲激响应不变法和双线性变换法。双线性变换法因其无混叠特性而更为常用。结合模拟域的频率变换技术，我们现在拥有了一套完整的流程，可以根据给定的数字指标设计出低通、高通、带通、带阻等各种类型的IIR数字滤波器。这些设计方法构成了数字信号处理中滤波器设计的坚实基础。

在后续的学习中，可能会涉及到这些滤波器的具体实现结构、有限字长效应分析以及与FIR滤波器的比较等内容。🚀

---